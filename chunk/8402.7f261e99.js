"use strict";(globalThis.webpackChunk_snx_v3_liquidity=globalThis.webpackChunk_snx_v3_liquidity||[]).push([[8402],{8402:(t,e,a)=>{a.r(e),a.d(e,{WithdrawModal:()=>G,WithdrawModalUi:()=>K,default:()=>z});var r=a(11082),s=a(59176),n=a(74008),o=a(84626),i=a(70065),l=a(2784),d=a(25042),c=a(40109),u=a(28145),w=a(76885),h=a(17716),y=a(50986),p=a(10528),m=a(99),b=a(35834),x=a(95772),f=a(42614),g=a(95522),S=a(60341),v=a(96596);const C=({accountId:t,collateralTypeAddress:e,amount:a})=>{const[r,s]=(0,l.useReducer)(h.I,h.E),{data:n}=(0,c.a)(),{data:o}=(0,f.L)(),{network:i}=(0,w.LN)(),{gasSpeed:d}=(0,x.jU)(),C=(0,w.mx)(),P=(0,w.yL)(),D=(0,u.useMutation)({mutationFn:async()=>{if(!C||!i||!P)throw new Error("No signer or network");if(!(n&&e&&a&&o))throw new Error("Not ready");if(a?.eq(0))throw new Error("Amount less than 0");const r=await C.getAddress();try{s({type:"prompting"});const l=(0,b.o)({provider:P}),c=new y.CH(e,["function decimals() view returns (uint8)"],P),u=await c.decimals(),w=a.gt(0)?(0,v.vz)(a.toString(),u):p.O$.from(0),h=n.populateTransaction.withdraw(p.O$.from(t),e,w),x=(0,g.$)(o,i.isTestnet).then((t=>(0,g.x)(r,o,t))),[f,D,$]=await Promise.all([l,h,x]),U=$.concat(D),T=await(0,S.dI)(i,U,"useWithdraw",r),k=(0,m.F)({gasLimit:T.gasLimit,gasPrices:f,gasSpeed:d}),j=await C.sendTransaction({...T,...k});s({type:"pending",payload:{txnHash:j.hash}}),await j.wait(),s({type:"success"})}catch(t){throw s({type:"error",payload:{error:t}}),t}}});return{mutation:D,txnState:r,settle:()=>s({type:"settled"}),isLoading:D.isPending,exec:D.mutateAsync}};var P=a(1492),D=a(97721),$=a(99581),U=a(75429),T=a(21849),k=a(77528),j=a(88383),A=a(51906),E=a(49494),N=a(7226),W=a(37330);function L(){const{network:t}=(0,w.LN)(),e=(0,w.yL)(),r=(0,w.mx)(),s=r||e,n=Boolean(r),{activeWallet:o}=(0,w.Os)();return(0,u.useQuery)({queryKey:[`${t?.id}-${t?.preset}`,"USDProxy",{withSigner:n},o?.address],queryFn:async function(){if(!s||!t)throw new Error("Should be disabled");const{address:e,abi:r}=await async function(t,e){if(!e)throw new Error("Missing preset");const r=`${Number(t).toFixed(0)}-${e}`;switch(r){case"1-main":{const[{default:t},{default:e}]=await Promise.all([a.e(9393).then(a.t.bind(a,29393,19)),a.e(8634).then(a.t.bind(a,38634,19))]);return{address:t.contracts.USDProxy,abi:e}}case"11155111-main":{const[{default:t},{default:e}]=await Promise.all([a.e(3463).then(a.t.bind(a,33463,19)),a.e(8538).then(a.t.bind(a,78538,19))]);return{address:t.contracts.USDProxy,abi:e}}case"10-main":{const[{default:t},{default:e}]=await Promise.all([a.e(2320).then(a.t.bind(a,62320,19)),a.e(6137).then(a.t.bind(a,46137,19))]);return{address:t.contracts.USDProxy,abi:e}}case"8453-andromeda":{const[{default:t},{default:e}]=await Promise.all([a.e(6244).then(a.t.bind(a,56244,19)),a.e(1020).then(a.t.bind(a,71020,19))]);return{address:t.contracts.USDProxy,abi:e}}case"84532-andromeda":{const[{default:t},{default:e}]=await Promise.all([a.e(6804).then(a.t.bind(a,96804,19)),a.e(2387).then(a.t.bind(a,42387,19))]);return{address:t.contracts.USDProxy,abi:e}}case"42161-main":{const[{default:t},{default:e}]=await Promise.all([a.e(8317).then(a.t.bind(a,98317,19)),a.e(2992).then(a.t.bind(a,12992,19))]);return{address:t.contracts.USDProxy,abi:e}}case"421614-main":{const[{default:t},{default:e}]=await Promise.all([a.e(5783).then(a.t.bind(a,15783,19)),a.e(6864).then(a.t.bind(a,36864,19))]);return{address:t.contracts.USDProxy,abi:e}}case"42161-arbthetix":{const[{default:t},{default:e}]=await Promise.all([a.e(2734).then(a.t.bind(a,52734,19)),a.e(5742).then(a.t.bind(a,65742,19))]);return{address:t.contracts.USDProxy,abi:e}}default:throw new Error(`Unsupported deployment ${r} for USDProxy`)}}(t.id,t.preset);return new y.CH(e,r,s)},enabled:Boolean(s),staleTime:1/0})}var q=a(82227),I=a(34367);const B=({accountId:t,availableCollateral:e,snxUSDCollateral:a,amountToWithdraw:r,accountCollateral:s,collateralSymbol:n})=>{const[o,i]=(0,l.useReducer)(h.I,h.E),{data:d}=(0,c.a)(),{data:y}=(0,N.b)(),{data:f}=L(),{data:g}=(0,q.Y_)(),{network:v}=(0,w.LN)(),{data:C}=(0,I.X)(),{gasSpeed:P}=(0,x.jU)(),D=(0,w.mx)(),$=(0,w.yL)(),U=(0,u.useMutation)({mutationFn:async()=>{if(!D||!v||!$)throw new Error("No signer or network");if(!(d&&y&&t&&C?.sUSD&&C.snxUSD))throw new Error("Not ready");if(a.add(e).lt(r))throw new Error("Exceeds balance");const o=r.gt(e)?e:r,l=r.sub(o).gt(0)?r.sub(o):j.GH;try{const a=(0,k.$l)(n);i({type:"prompting"});const r=(0,b.o)({provider:$}),c=o.gt(0)?d.populateTransaction.withdraw(p.O$.from(t),s?.tokenAddress,o.toBN()):void 0,u=l.gt(0)?d.populateTransaction.withdraw(p.O$.from(t),C?.snxUSD,l.toBN()):void 0,w=l.gt(0)?f?.populateTransaction.approve(y.address,l.toBN()):void 0,h=l.gt(0)?y.populateTransaction.buy(a,l.toBN(),0,A.d):void 0,x=l.gt(0)?(await y.callStatic.quoteBuyExactIn(a,l.toBN(),0)).synthAmount:j.GH,U=e.add(x),T=y.populateTransaction.unwrap(a,U.toBN(),Number(E.bM(U.toBN().mul(98).div(100).toString(),12).toString()).toFixed()),[N,L,q,I,B,H]=await Promise.all([r,c,u,w,h,T]),O=[L,q,I,B,H].filter(W._);g&&O.unshift(g);const _=await D.getAddress(),F=await(0,S.dI)(v,O,"useWithdrawBase",_),M=(0,m.F)({gasLimit:F.gasLimit,gasPrices:N,gasSpeed:P}),Q=await D.sendTransaction({...F,...M});i({type:"pending",payload:{txnHash:Q.hash}}),await Q.wait(),i({type:"success"})}catch(t){throw i({type:"error",payload:{error:t}}),t}}});return{mutation:U,txnState:o,settle:()=>i({type:"settled"}),isLoading:U.isPending,exec:U.mutateAsync}};var H=a(13797),O=a(89536),_=a(45071),F=a(73635),M=a(64996),Q=a(52322);const K=({isDebtWithdrawal:t,amount:e,isOpen:a,onClose:i,onSubmit:l,state:c,symbol:u})=>{if(a)return c.step>1?(0,Q.jsx)(T.s,{onClose:l,title:(t?"Debt":"Collateral")+" successfully Withdrawn",subline:(0,Q.jsxs)(Q.Fragment,{children:["Your ",(0,Q.jsx)("b",{children:t?"Debt":"Collateral"})," has been withdrawn, read more about it in the"," ",(0,Q.jsx)(r.r,{href:"https://docs.synthetix.io/v/synthetix-v3-user-documentation",target:"_blank",color:"cyan.500",children:"Synthetix V3 Documentation"})]}),alertText:(t?"Debt":"Collateral")+" successfully Withdrawn"}):(0,Q.jsxs)("div",{children:[(0,Q.jsxs)(s.x,{color:"gray.50",fontSize:"20px",fontWeight:700,children:[(0,Q.jsx)(U.R,{cursor:"pointer",onClick:i,mr:2}),"Manage ",t?"Debt":"Collateral"]}),(0,Q.jsx)(n.i,{my:4}),(0,Q.jsx)(d.P0,{step:1,title:"Withdraw",subtitle:(0,Q.jsxs)(s.x,{as:"div",children:[(0,Q.jsx)(_.$,{value:e}),"Â ",u," will be withdrawn"]}),status:{failed:1===c.step&&"error"===c.status,success:c.step>1,loading:1===c.step&&"pending"===c.status}}),(0,Q.jsx)(o.z,{isDisabled:"pending"===c.status,onClick:l,width:"100%",mt:"6","data-testid":"withdraw confirm button",children:(()=>{switch(!0){case"error"===c.status:return"Retry";case"pending"===c.status:return"Processing...";case c.step>1:return"Done";default:return"Execute Transaction"}})()})]})};function G({liquidityPosition:t,onClose:e,isOpen:a,isDebtWithdrawal:r=!1}){const[s,n]=(0,l.useState)({step:1,status:"idle"}),o=(0,O.UO)(),d=(0,i.p)({isClosable:!0,duration:9e3}),{network:h}=(0,w.LN)(),y=(0,u.useQueryClient)(),{withdrawAmount:p,setWithdrawAmount:m}=(0,l.useContext)(H.n),{data:b}=(0,M.t)(o.collateralSymbol),{data:x}=(0,c.a)(),f=(0,D.o)(x),g=t?.accountId,{data:S}=(0,F.p)(),{data:v}=(0,P.jZ)(g,S?.address),{mutation:U}=C({amount:p,accountId:g,collateralTypeAddress:r?S.address:t?.accountCollateral.tokenAddress}),{mutation:T}=B({accountId:g,availableCollateral:t?.accountCollateral.availableCollateral||j.GH,snxUSDCollateral:v?.availableCollateral||j.GH,amountToWithdraw:p,accountCollateral:t?.accountCollateral,collateralSymbol:o.collateralSymbol}),A=(0,l.useCallback)((async()=>{try{1===s.step?(n({step:1,status:"pending"}),(0,k.Yz)(h?.id,h?.preset)?await T.mutateAsync():await U.mutateAsync(),n({step:2,status:"success"}),y.invalidateQueries({queryKey:[`${h?.id}-${h?.preset}`,"LiquidityPosition",{accountId:g}]}),y.invalidateQueries({queryKey:[`${h?.id}-${h?.preset}`,"AccountSpecificCollateral",{accountId:g}]}),y.invalidateQueries({queryKey:[`${h?.id}-${h?.preset}`,"LiquidityPositions",{accountId:g}]}),y.invalidateQueries({queryKey:[`${h?.id}-${h?.preset}`,"AccountCollateralUnlockDate",{accountId:g}]}),y.invalidateQueries({queryKey:[`${h?.id}-${h?.preset}`,"TokenBalance"]}),m(j.GH)):e()}catch(t){n((t=>({...t,status:"error"})));const e=f(t);throw e&&console.error(new Error(e.name),e),d.closeAll(),d({title:"Withdraw failed",description:e?(0,Q.jsx)($.M,{contractError:e}):"Please try again.",status:"error",variant:"left-accent"}),Error("Withdraw failed",{cause:t})}}),[g,f,h?.id,h?.preset,e,y,m,d,s.step,T,U]);return(0,Q.jsx)(K,{amount:p,isOpen:a,onClose:e,symbol:r?S.symbol:b?.symbol,state:s,onSubmit:A,isDebtWithdrawal:r})}const z=G}}]);
//# sourceMappingURL=8402.7f261e99.js.map