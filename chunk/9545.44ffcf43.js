"use strict";(globalThis.webpackChunk_snx_v3_liquidity=globalThis.webpackChunk_snx_v3_liquidity||[]).push([[9545],{49545:(e,t,a)=>{a.r(t),a.d(t,{UndelegateModal:()=>Q,UndelegateModalUi:()=>V,default:()=>K});var l=a(11082),r=a(59176),o=a(74008),n=a(84626),s=a(70065),c=a(45071),i=a(99581),u=a(77528),d=a(13797),m=a(25042),h=a(76885),b=a(64996),C=a(97721),g=a(40109),x=a(89536),y=a(70332),p=a(42736),f=a(79929),S=a(28145),j=a(97737),v=a(2784),k=a(9875),w=a(97386);const T="SET_AMOUNT",E="SET_COLLATERAL_SYMBOL",A="RETRY",U="RUN",_="RESET",D="idle",P="undelegate",q="failed",G="success",I={[P]:P},M="undelegate",H={amount:(0,f.wei)(0),error:null,collateralSymbol:void 0},O=(0,k.C)({id:"UndelegateMachine",initial:D,predictableActionArguments:!0,context:H,on:{[_]:{target:D,actions:(0,w.f0)({amount:e=>H.amount,error:e=>H.error,collateralSymbol:e=>H.collateralSymbol})},[T]:{actions:(0,w.f0)({amount:(e,t)=>t.amount})},[E]:{actions:(0,w.f0)({collateralSymbol:(e,t)=>t.symbol})}},states:{[D]:{on:{[U]:[{target:P,cond:e=>e.amount.gt(0)}]}},[P]:{invoke:{src:M,onError:{target:q,actions:(0,w.f0)({error:(e,t)=>({error:t.data,step:I.undelegate})})},onDone:[{target:G}]}},[q]:{on:{[A]:[{target:P,cond:e=>e.error?.step===I.undelegate,actions:(0,w.f0)({error:e=>null})}]}},[G]:{}}});var R=a(75429),L=a(21849),z=a(88383),Y=a(92435),$=a(96596),B=a(52465),F=a(81826),N=a(52322);const V=({txSummary:e,amount:t,isOpen:a,onClose:s,collateralType:i,onSubmit:u,state:d,error:h})=>{const b=d.matches(P);if(a)return d.matches(G)?(0,N.jsx)(L.s,{onClose:u,title:"Collateral successfully Updated",subline:(0,N.jsxs)(N.Fragment,{children:["Your ",(0,N.jsx)("b",{children:"Collateral"})," has been updated, read more about it in the"," ",(0,N.jsx)(l.r,{href:"https://docs.synthetix.io/v/synthetix-v3-user-documentation",target:"_blank",color:"cyan.500",children:"Synthetix V3 Documentation"})]}),alertText:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("b",{children:"Collateral"})," successfully Updated"]}),summary:e}):(0,N.jsxs)("div",{children:[(0,N.jsxs)(r.x,{color:"gray.50",fontSize:"20px",fontWeight:700,children:[(0,N.jsx)(R.R,{cursor:"pointer",onClick:s,mr:2}),"Manage Collateral"]}),(0,N.jsx)(o.i,{my:4}),(0,N.jsx)(m.P0,{step:1,title:"Unlock collateral",subtitle:(0,N.jsxs)(r.x,{as:"div",children:[(0,N.jsx)(c.$,{value:t,suffix:` ${i?.displaySymbol}`})," will be unlocked from the pool."]}),status:{failed:Boolean(h?.step===P),disabled:t.eq(0),success:d.matches(G),loading:d.matches(P)&&!h}}),(0,N.jsx)(n.z,{isDisabled:b,onClick:u,width:"100%",mt:"6","data-testid":"undelegate confirm button",children:(()=>{switch(!0){case Boolean(h):return"Retry";case b:return"Processing...";case d.matches(G):return"Continue";default:return"Execute Transaction"}})()})]})},Q=({onClose:e,isOpen:t,liquidityPosition:a})=>{const l=(0,x.UO)(),{collateralChange:r,setCollateralChange:o}=(0,v.useContext)(d.n),{network:n}=(0,h.LN)(),c=(0,S.useQueryClient)(),{data:m}=(0,b.t)(l.collateralSymbol),k=(0,s.p)({isClosable:!0,duration:9e3}),[w,D]=(0,v.useState)({currentCollateral:z.GH,collateralChange:z.GH,currentDebt:z.GH}),P=a?.collateralAmount||(0,f.wei)(0),{exec:q}=(0,y.V)({accountId:l.accountId,poolId:l.poolId,collateralTypeAddress:a?.tokenAddress,collateralChange:r,currentCollateral:P}),{exec:I}=(0,p.G)({accountId:l.accountId,poolId:l.poolId,collateralTypeAddress:a?.tokenAddress,collateralChange:r,currentCollateral:P,liquidityPosition:a}),{data:H}=(0,g.a)(),R=(0,C.o)(H),L=(0,u.Yz)(n?.id,n?.preset),[Q,K]=(0,j.e)(O,{context:{amount:r.abs()},services:{[M]:async()=>{try{D({currentCollateral:P,currentDebt:a?.debt||z.GH,collateralChange:r}),L?await I():await q(),await c.invalidateQueries({queryKey:[`${n?.id}-${n?.preset}`,"LiquidityPosition"],exact:!1}),o(z.GH)}catch(e){const t=R(e);throw t&&console.error(new Error(t.name),t),k.closeAll(),k({title:"Unlock collateral failed",description:t?(0,N.jsx)(i.M,{contractError:t}):"Please try again.",status:"error",variant:"left-accent"}),Error("Unlock collateral failed",{cause:e})}}}}),W=r.toString();(0,v.useEffect)((()=>{K(T,{amount:(0,f.wei)(W).abs()})}),[W,K]),(0,v.useEffect)((()=>{K(E,{symbol:(0,f.wei)(W).abs()})}),[W,K]);const X=(0,v.useCallback)((async()=>{if(Q.matches(G))return K(_),void e();Q.context.error?K(A):K(U)}),[e,K,Q]),J=(0,v.useMemo)((()=>{const e=[{label:"Total "+m?.displaySymbol,value:(0,N.jsx)(Y.DX,{value:w.currentCollateral,newValue:w.currentCollateral.add(w.collateralChange),formatFn:e=>(0,$.Aq)(e),hasChanges:w.collateralChange.abs().gt(0),size:"sm"})}];return L?e:[...e,{label:"C-ratio",value:(0,N.jsx)(B.p,{currentCollateral:w.currentCollateral,currentDebt:w.currentDebt,collateralChange:w.collateralChange,collateralPrice:a?.collateralPrice??z.GH,debtChange:z.GH,size:"sm"})}]}),[m?.displaySymbol,L,a?.collateralPrice,w.collateralChange,w.currentCollateral,w.currentDebt]);return(0,N.jsx)(V,{amount:Q.context.amount,isOpen:t,onClose:e,collateralType:m,state:Q,error:Q.context.error,onSubmit:X,txSummary:(0,N.jsx)(F.v,{items:J})})},K=Q}}]);
//# sourceMappingURL=9545.44ffcf43.js.map