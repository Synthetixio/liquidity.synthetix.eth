{"version":3,"file":"chunk/9844.a272383f.js","mappings":"uYAGO,MAAMA,EAAS,CACpBC,WAAY,aACZC,sBAAuB,wBACvBC,MAAO,QACPC,IAAK,MACLC,QAAS,UACTC,QAAS,UACTC,MAAO,SAGIC,EAAQ,CACnBC,KAAM,OACNC,SAAU,WACVC,OAAQ,SACRC,OAAQ,SACRC,QAAS,WAGEC,EAAc,CACzB,CAACN,EAAME,UAAWF,EAAME,SACxB,CAACF,EAAMG,QAASH,EAAMG,QAGXI,EAAe,CAC1BL,SAAU,WACVC,OAAQ,UA4CJK,EAAiB,CACrBC,QAAQC,EAAAA,EAAAA,KAAI,GACZC,MAAO,KACPC,sBAAkBC,GAEPC,GAAkBC,EAAAA,EAAAA,GAAqD,CAClFC,GAAI,kBACJC,QAASjB,EAAMC,KACfiB,4BAA4B,EAC5BC,QAASX,EACTY,GAAI,CACF,CAAC5B,EAAOO,OAAQ,CACdsB,OAAQrB,EAAMC,KACdqB,SAASC,EAAAA,EAAAA,IAAO,CACdd,OAASe,GAAMhB,EAAeC,OAC9BE,MAAQa,GAAMhB,EAAeG,MAC7BC,iBAAmBY,GAAMhB,EAAeI,oBAG5C,CAACpB,EAAOC,YAAa,CACnB6B,SAASC,EAAAA,EAAAA,IAAO,CAAEd,OAAQA,CAACgB,EAAUC,IAAUA,EAAMjB,UAEvD,CAACjB,EAAOE,uBAAwB,CAC9B4B,SAASC,EAAAA,EAAAA,IAAO,CAAEX,iBAAkBA,CAACa,EAAUC,IAAUA,EAAMC,WAGnEC,OAAQ,CACN,CAAC5B,EAAMC,MAAO,CACZmB,GAAI,CACF,CAAC5B,EAAOI,KAAM,CACZ,CAAEyB,OAAQrB,EAAME,SAAU2B,KAAOV,GAAYA,EAAQV,OAAOqB,GAAG,IAC/D,CACET,OAAQrB,EAAMG,OACd0B,KAAOV,GAAYA,EAAQV,OAAOqB,GAAG,IAAmC,SAA7BX,EAAQP,qBAK3D,CAACZ,EAAME,UAAW,CAChB6B,OAAQ,CACNC,IAAKzB,EAAaL,SAClB+B,QAAS,CACPZ,OAAQrB,EAAMI,OACdkB,SAASC,EAAAA,EAAAA,IAAO,CACdZ,MAAOA,CAACc,EAAUC,KAAU,CAAGf,MAAOe,EAAMQ,KAAMC,KAAM7B,EAAYJ,cAGxEkC,OAAQ,CACN,CAAEf,OAAQrB,EAAMG,OAAQ0B,KAAOV,GAAyC,SAA7BA,EAAQP,kBACnD,CAAES,OAAQrB,EAAMK,YAKtB,CAACL,EAAMG,QAAS,CACd4B,OAAQ,CACNC,IAAKzB,EAAaJ,OAClBiC,OAAQ,CACNf,OAAQrB,EAAMK,SAEhB4B,QAAS,CACPZ,OAAQrB,EAAMI,OACdkB,SAASC,EAAAA,EAAAA,IAAO,CACdZ,MAAOA,CAACc,EAAUC,KAAU,CAAGf,MAAOe,EAAMQ,KAAMC,KAAM7B,EAAYH,cAK5E,CAACH,EAAMI,QAAS,CACdgB,GAAI,CACF,CAAC5B,EAAOG,OAAQ,CACd,CACE0B,OAAQrB,EAAME,SACd2B,KAAOQ,GAAMA,EAAE1B,OAAOwB,OAAS7B,EAAYJ,SAC3CoB,SAASC,EAAAA,EAAAA,IAAO,CAAEZ,MAAQa,GAAM,QAElC,CACEH,OAAQrB,EAAMG,OACd0B,KAAOQ,GAAMA,EAAE1B,OAAOwB,OAAS7B,EAAYH,OAC3CmB,SAASC,EAAAA,EAAAA,IAAO,CAAEZ,MAAQa,GAAM,WAKxC,CAACxB,EAAMK,SAAU,CAAC,K,qIC9If,MAAMiC,EAAcA,EACzBC,YACAC,wBACAC,wBAMA,MAAOC,EAAUC,IAAYC,EAAAA,EAAAA,YAAWC,EAAAA,EAASC,EAAAA,IACzCZ,KAAMa,IAAcC,EAAAA,EAAAA,MACpBd,KAAMe,IAAuBC,EAAAA,EAAAA,MAC/B,QAAEC,IAAYC,EAAAA,EAAAA,OAEd,SAAEC,IAAaC,EAAAA,EAAAA,MACfC,GAASC,EAAAA,EAAAA,MACTC,GAAWC,EAAAA,EAAAA,MAEXC,GAAWC,EAAAA,EAAAA,aAAY,CAC3BC,WAAYC,UACV,IAAKP,IAAWJ,IAAYM,EAAU,MAAM,IAAIM,MAAM,wBAEtD,KAEIhB,GACAP,GACAC,GAAmBuB,qBACnBf,GAGF,OACF,GAAIR,GAAmBuB,oBAAoBC,GAAG,GAAI,OAClD,MAAMC,QAAsBX,EAAOY,aAEnC,IACExB,EAAS,CAAEyB,KAAM,cAEjB,MAAMC,GAAoBC,EAAAA,EAAAA,GAAY,CAAEb,aAElCc,EAAuBxB,EAAUyB,oBAAoBtE,SACzDuE,EAAAA,GAAUC,KAAKnC,GACfC,EACAC,GAAmBuB,oBAAoBW,QAGnCC,GAA8BC,EAAAA,EAAAA,GAClC5B,EACAE,EAAQ2B,WACRC,MAAMC,IACNC,EAAAA,EAAAA,GAA0Bf,EAAejB,EAAoB+B,MAExDE,EAAWC,EAAcC,SAA8BC,QAAQC,IAAI,CACxEjB,EACAE,EACAK,IAEIW,EAAWH,EAAqBI,OAAOL,GAEvCM,QAAkBC,EAAAA,EAAAA,IAAYvC,EAASoC,EAAU,eAEjDI,GAA2BC,EAAAA,EAAAA,GAA6B,CAC5DC,SAAUJ,EAAUI,SACpBX,YACA7B,aAGIyC,QAAYvC,EAAOwC,gBAAgB,IAAKN,KAAcE,IAC5DhD,EAAS,CAAEyB,KAAM,UAAW4B,QAAS,CAAEC,QAASH,EAAII,cAE9CJ,EAAIK,OACVxD,EAAS,CAAEyB,KAAM,WACnB,CAAE,MAAOzD,GAEP,MADAgC,EAAS,CAAEyB,KAAM,QAAS4B,QAAS,CAAErF,WAC/BA,CACR,KAGJ,MAAO,CACLgD,WACAjB,WACA0D,OAAQA,IAAMzD,EAAS,CAAEyB,KAAM,YAC/BiC,UAAW1C,EAAS2C,UACpBC,KAAM5C,EAAS6C,YAChB,E,gDCpEI,MAAMC,EAQRA,EAAGhG,SAAQiG,SAAQC,UAASlE,oBAAmBmE,WAAUC,QAAOlG,YACnE,MAAMmG,EAAeD,EAAME,QAAQ/G,EAAME,WAAa2G,EAAME,QAAQ/G,EAAMG,QAC1E,OACE6G,EAAAA,EAAAA,MAACC,EAAAA,GAAK,CAACC,KAAK,KAAKR,OAAQA,EAAQC,QAASA,EAASQ,qBAAqB,EAAMC,SAAA,EAC5EC,EAAAA,EAAAA,KAACC,EAAAA,EAAY,KACbN,EAAAA,EAAAA,MAACO,EAAAA,EAAY,CAACC,GAAG,QAAQC,MAAM,QAAQ,cAAY,iBAAgBL,SAAA,EACjEC,EAAAA,EAAAA,KAACK,EAAAA,EAAgB,KACjBL,EAAAA,EAAAA,KAACM,EAAAA,EAAW,CAAAP,SAAC,0BACbC,EAAAA,EAAAA,KAACO,EAAAA,EAAgB,KACjBZ,EAAAA,EAAAA,MAACa,EAAAA,EAAS,CAAAT,SAAA,EACRC,EAAAA,EAAAA,KAACS,EAAAA,EAAI,CAACC,GAAG,IAAGX,SAAC,gDAEbC,EAAAA,EAAAA,KAACW,EAAAA,GAAS,CACR7F,KAAM,EACN8F,MAAM,WACNC,UACElB,EAAAA,EAAAA,MAACc,EAAAA,EAAI,CAACK,GAAG,MAAKf,SAAA,EACZC,EAAAA,EAAAA,KAACe,EAAAA,EAAM,CAACC,MAAO5H,EAAQ6H,OAAS,IAAG7F,GAAmBd,WAAY,wBAGtE4G,OAAQ,CACNnI,OAAQoI,QAAQ7H,GAAOwB,OAASnC,EAAME,UACtCuI,SAAUhI,EAAOwD,GAAG,GACpB5D,QAASwG,EAAME,QAAQ/G,EAAMG,SAAW0G,EAAME,QAAQ/G,EAAMK,SAC5DqI,QAAS7B,EAAME,QAAQ/G,EAAME,YAAcS,KAGhB,SAA9B8B,GAAmBd,QAClB0F,EAAAA,EAAAA,KAACW,EAAAA,GAAS,CACR7F,KAAM,EACN8F,MAAQ,UAASxF,GAAmBd,SACpCuG,SAAS,oCACTK,OAAQ,CACNnI,OAAQoI,QAAQ7H,GAAOwB,OAASnC,EAAMG,QACtCsI,SAAwC,SAA9BhG,GAAmBd,OAC7BtB,QAASwG,EAAME,QAAQ/G,EAAMK,SAC7BqI,QAAS7B,EAAME,QAAQ/G,EAAMG,WAG/B,MAEJkH,EAAAA,EAAAA,KAACsB,EAAAA,EAAM,CACLC,WAAY9B,EACZ+B,QAASjC,EACTkC,MAAM,OACNC,GAAG,IACH,cAAY,0BAAyB3B,SAEpC,MACC,QAAQ,GACN,KAAKoB,QAAQ7H,GACX,MAAO,QACT,KAAKmG,EACH,MAAO,gBACT,KAAKD,EAAME,QAAQ/G,EAAMK,SACvB,MAAO,OACT,QACE,MAAO,QAEZ,EAXA,aAeD,EAIL,SAAS2I,GAAc,kBAC5BvG,EAAiB,QACjBkE,EAAO,OACPD,IAMA,MAAMuC,GAASC,EAAAA,EAAAA,MACTC,GAAQC,EAAAA,EAAAA,GAAS,CAAEC,YAAY,EAAMC,SAAU,OAC/C,QAAEnG,IAAYC,EAAAA,EAAAA,OAEZmD,KAAMpG,IAAWoJ,EAAAA,EAAAA,MAEjBhD,KAAMiD,GAAiBlH,EAAY,CACzCC,UAAW0G,EAAO1G,UAClBC,sBAAuBC,GAAmBgH,aAC1ChH,sBAGIiH,GAAcC,EAAAA,EAAAA,mBAEZzH,KAAMa,IAAcC,EAAAA,EAAAA,KACtB4G,GAAuBC,EAAAA,EAAAA,GAAuB9G,IAE7C8D,EAAOiD,IAAQC,EAAAA,EAAAA,GAAWjJ,EAAiB,CAChDK,QAAS,CACPV,OAAQgC,GAAmBuB,qBAE7BgG,SAAU,CACR,CAACzJ,EAAaL,UAAW4D,UACvB,UACQ0F,UACAE,EAAYO,kBAAkB,CAClCC,SAAU,CAAE,GAAE/G,GAASnC,MAAMmC,GAASgH,SAAU,8BAEpD,CAAE,MAAOxJ,GACP,MAAMyJ,EAAgBR,EAAqBjJ,GAc3C,MAbIyJ,GACFC,QAAQ1J,MAAM,IAAIoD,MAAMqG,EAAcE,MAAOF,GAE/CjB,EAAMoB,WACNpB,EAAM,CACJlB,MAAO,kBACPuC,YAAaJ,GACX/C,EAAAA,EAAAA,KAACoD,EAAAA,EAAa,CAACL,cAAeA,IAE9B,oBAEF7B,OAAQ,UAEJxE,MAAM,kBAAmB,CAAE2G,MAAO/J,GAC1C,GAEF,CAACJ,EAAaJ,QAAS2D,UACrB,IACEqF,EAAM,CACJlB,MAAO,SACPuC,YAAa,0BACbjC,OAAQ,eAGJpI,EAAO0G,EAAM1F,QAAQV,OAC7B,CAAE,MAAOkK,GAGP,MAFAxB,EAAMoB,WACNpB,EAAM,CAAElB,MAAO,gBAAiBuC,YAAa,oBAAqBjC,OAAQ,UACpExE,MAAM,gBAAiB,CAAE2G,MAAOC,GACxC,MAKA/D,GAAWgE,EAAAA,EAAAA,cAAY9G,UAC3B,GAAI+C,EAAME,QAAQ/G,EAAMK,SAGtB,OAFAyJ,EAAKtK,EAAOO,YACZ4G,IAGEE,EAAM1F,QAAQR,MAChBmJ,EAAKtK,EAAOG,OAGdmK,EAAKtK,EAAOI,IAAI,GACf,CAAC+G,EAASmD,EAAMjD,IAEnB,OACEQ,EAAAA,EAAAA,KAACZ,EAAe,CACdhG,OAAQoG,EAAM1F,QAAQV,OACtBiG,OAAQA,EACRC,QAASA,EACTlE,kBAAmBA,EACnBoE,MAAOA,EACPlG,MAAOkG,EAAM1F,QAAQR,MACrBiG,SAAUA,GAGhB,CCvMA,S","sources":["webpack://@snx-v3/liquidity/../components/WithdrawModal/WithdrawMachine.ts","webpack://@snx-v3/liquidity/../lib/useWithdraw/useWithdraw.tsx","webpack://@snx-v3/liquidity/../components/WithdrawModal/WithdrawModal.tsx","webpack://@snx-v3/liquidity/../components/WithdrawModal/index.ts"],"sourcesContent":["import Wei, { wei } from '@synthetixio/wei';\nimport { createMachine, assign } from 'xstate';\n\nexport const Events = {\n  SET_AMOUNT: 'SET_AMOUNT',\n  SET_COLLATERAL_SYMBOL: 'SET_COLLATERAL_SYMBOL',\n  RETRY: 'RETRY',\n  RUN: 'RUN',\n  SUCCESS: 'SUCCESS',\n  FAILURE: 'FAILURE',\n  RESET: 'RESET',\n} as const;\n\nexport const State = {\n  idle: 'idle',\n  withdraw: 'withdraw',\n  unwrap: 'unwrap',\n  failed: 'failed',\n  success: 'success',\n} as const;\n\nexport const FailedSteps = {\n  [State.withdraw]: State.withdraw,\n  [State.unwrap]: State.unwrap,\n} as const;\n\nexport const ServiceNames = {\n  withdraw: 'withdraw',\n  unwrap: 'unwrap',\n} as const;\n\ntype Context = {\n  error: { error: Error; step: keyof typeof FailedSteps } | null;\n  amount: Wei;\n  collateralSymbol?: string;\n};\n\ntype EventType = typeof Events;\ntype WithdrawEvents =\n  | { type: EventType['SET_AMOUNT']; amount: Wei }\n  | { type: EventType['SET_COLLATERAL_SYMBOL']; symbol: string }\n  | { type: EventType['RETRY'] }\n  | { type: EventType['RUN'] }\n  | { type: EventType['SUCCESS'] }\n  | { type: EventType['FAILURE'] }\n  | { type: EventType['RESET'] };\n\ntype StateType = typeof State;\nexport type MachineState =\n  | {\n      value: StateType['idle'];\n      context: Context & { error: null };\n    }\n  | {\n      value: StateType['withdraw'];\n      context: Context & { error: null };\n    }\n  | {\n      value: StateType['unwrap'];\n      context: Context & { error: null };\n    }\n  | {\n      value: StateType['failed'];\n      context: Context & { error: { error: Error; step: keyof typeof FailedSteps } };\n    }\n  | {\n      value: StateType['success'];\n      context: Context & {\n        error: null;\n      };\n    };\n\nconst initialContext = {\n  amount: wei(0),\n  error: null,\n  collateralSymbol: undefined,\n};\nexport const WithdrawMachine = createMachine<Context, WithdrawEvents, MachineState>({\n  id: 'WithdrawMachine',\n  initial: State.idle,\n  predictableActionArguments: true,\n  context: initialContext,\n  on: {\n    [Events.RESET]: {\n      target: State.idle,\n      actions: assign({\n        amount: (_) => initialContext.amount,\n        error: (_) => initialContext.error,\n        collateralSymbol: (_) => initialContext.collateralSymbol,\n      }),\n    },\n    [Events.SET_AMOUNT]: {\n      actions: assign({ amount: (_context, event) => event.amount }),\n    },\n    [Events.SET_COLLATERAL_SYMBOL]: {\n      actions: assign({ collateralSymbol: (_context, event) => event.symbol }),\n    },\n  },\n  states: {\n    [State.idle]: {\n      on: {\n        [Events.RUN]: [\n          { target: State.withdraw, cond: (context) => context.amount.gt(0) },\n          {\n            target: State.unwrap,\n            cond: (context) => context.amount.gt(0) && context.collateralSymbol === 'WETH',\n          },\n        ],\n      },\n    },\n    [State.withdraw]: {\n      invoke: {\n        src: ServiceNames.withdraw,\n        onError: {\n          target: State.failed,\n          actions: assign({\n            error: (_context, event) => ({ error: event.data, step: FailedSteps.withdraw }),\n          }),\n        },\n        onDone: [\n          { target: State.unwrap, cond: (context) => context.collateralSymbol === 'WETH' },\n          { target: State.success },\n        ],\n      },\n    },\n\n    [State.unwrap]: {\n      invoke: {\n        src: ServiceNames.unwrap,\n        onDone: {\n          target: State.success,\n        },\n        onError: {\n          target: State.failed,\n          actions: assign({\n            error: (_context, event) => ({ error: event.data, step: FailedSteps.unwrap }),\n          }),\n        },\n      },\n    },\n    [State.failed]: {\n      on: {\n        [Events.RETRY]: [\n          {\n            target: State.withdraw,\n            cond: (c) => c.error?.step === FailedSteps.withdraw,\n            actions: assign({ error: (_) => null }),\n          },\n          {\n            target: State.unwrap,\n            cond: (c) => c.error?.step === FailedSteps.unwrap,\n            actions: assign({ error: (_) => null }),\n          },\n        ],\n      },\n    },\n    [State.success]: {},\n  },\n});\n","import { useReducer } from 'react';\nimport { useCoreProxy } from '@snx-v3/useCoreProxy';\nimport { useMutation } from '@tanstack/react-query';\nimport { useNetwork, useProvider, useSigner } from '@snx-v3/useBlockchain';\nimport { initialState, reducer } from '@snx-v3/txnReducer';\nimport { BigNumber } from 'ethers';\nimport { formatGasPriceForTransaction } from '@snx-v3/useGasOptions';\nimport { getGasPrice } from '@snx-v3/useGasPrice';\nimport { useGasSpeed } from '@snx-v3/useGasSpeed';\nimport { AccountCollateralWithSymbol } from '@snx-v3/useAccountCollateral';\nimport { useAllCollateralPriceIds } from '@snx-v3/useAllCollateralPriceIds';\nimport { fetchPriceUpdates, priceUpdatesToPopulatedTx } from '@snx-v3/fetchPythPrices';\nimport { withERC7412 } from '@snx-v3/withERC7412';\n\nexport const useWithdraw = ({\n  accountId,\n  collateralTypeAddress,\n  accountCollateral,\n}: {\n  accountId?: string;\n  collateralTypeAddress?: string;\n  accountCollateral: AccountCollateralWithSymbol;\n}) => {\n  const [txnState, dispatch] = useReducer(reducer, initialState);\n  const { data: CoreProxy } = useCoreProxy();\n  const { data: collateralPriceIds } = useAllCollateralPriceIds();\n  const { network } = useNetwork();\n\n  const { gasSpeed } = useGasSpeed();\n  const signer = useSigner();\n  const provider = useProvider();\n\n  const mutation = useMutation({\n    mutationFn: async () => {\n      if (!signer || !network || !provider) throw new Error('No signer or network');\n\n      if (\n        !(\n          CoreProxy &&\n          collateralTypeAddress &&\n          accountCollateral?.availableCollateral &&\n          collateralPriceIds\n        )\n      )\n        return;\n      if (accountCollateral?.availableCollateral.eq(0)) return;\n      const walletAddress = await signer.getAddress();\n\n      try {\n        dispatch({ type: 'prompting' });\n\n        const gasPricesPromised = getGasPrice({ provider });\n\n        const populatedTxnPromised = CoreProxy.populateTransaction.withdraw(\n          BigNumber.from(accountId),\n          collateralTypeAddress,\n          accountCollateral?.availableCollateral.toBN()\n        );\n\n        const collateralPriceCallsPromise = fetchPriceUpdates(\n          collateralPriceIds,\n          network.isTestnet\n        ).then((signedData) =>\n          priceUpdatesToPopulatedTx(walletAddress, collateralPriceIds, signedData)\n        );\n        const [gasPrices, populatedTxn, collateralPriceCalls] = await Promise.all([\n          gasPricesPromised,\n          populatedTxnPromised,\n          collateralPriceCallsPromise,\n        ]);\n        const allCalls = collateralPriceCalls.concat(populatedTxn);\n\n        const erc7412Tx = await withERC7412(network, allCalls, 'useWithdraw');\n\n        const gasOptionsForTransaction = formatGasPriceForTransaction({\n          gasLimit: erc7412Tx.gasLimit,\n          gasPrices,\n          gasSpeed,\n        });\n\n        const txn = await signer.sendTransaction({ ...erc7412Tx, ...gasOptionsForTransaction });\n        dispatch({ type: 'pending', payload: { txnHash: txn.hash } });\n\n        await txn.wait();\n        dispatch({ type: 'success' });\n      } catch (error: any) {\n        dispatch({ type: 'error', payload: { error } });\n        throw error;\n      }\n    },\n  });\n  return {\n    mutation,\n    txnState,\n    settle: () => dispatch({ type: 'settled' }),\n    isLoading: mutation.isPending,\n    exec: mutation.mutateAsync,\n  };\n};\n","import {\n  Button,\n  Modal,\n  ModalBody,\n  ModalCloseButton,\n  ModalContent,\n  ModalHeader,\n  ModalOverlay,\n  Text,\n  useToast,\n} from '@chakra-ui/react';\nimport React, { FC, useCallback } from 'react';\nimport { Amount } from '@snx-v3/Amount';\nimport { useUnWrapEth } from '@snx-v3/useWrapEth';\nimport { Multistep } from '@snx-v3/Multistep';\nimport { Wei } from '@synthetixio/wei';\nimport { useParams } from '@snx-v3/useParams';\nimport { Events, ServiceNames, State, WithdrawMachine } from './WithdrawMachine';\nimport { useMachine } from '@xstate/react';\nimport { useWithdraw } from '@snx-v3/useWithdraw';\nimport type { StateFrom } from 'xstate';\nimport { AccountCollateralWithSymbol } from '@snx-v3/useAccountCollateral';\nimport { useContractErrorParser } from '@snx-v3/useContractErrorParser';\nimport { useCoreProxy } from '@snx-v3/useCoreProxy';\nimport { ContractError } from '@snx-v3/ContractError';\nimport { WithdrawIncrease } from '@snx-v3/WithdrawIncrease';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { useNetwork } from '@snx-v3/useBlockchain';\n\nexport const WithdrawModalUi: FC<{\n  amount: Wei;\n  isOpen: boolean;\n  onClose: () => void;\n  accountCollateral?: AccountCollateralWithSymbol;\n  state: StateFrom<typeof WithdrawMachine>;\n  error: { error: Error; step: string } | null;\n  onSubmit: () => void;\n}> = ({ amount, isOpen, onClose, accountCollateral, onSubmit, state, error }) => {\n  const isProcessing = state.matches(State.withdraw) || state.matches(State.unwrap);\n  return (\n    <Modal size=\"lg\" isOpen={isOpen} onClose={onClose} closeOnOverlayClick={false}>\n      <ModalOverlay />\n      <ModalContent bg=\"black\" color=\"white\" data-testid=\"withdraw modal\">\n        <WithdrawIncrease />\n        <ModalHeader>Complete this action</ModalHeader>\n        <ModalCloseButton />\n        <ModalBody>\n          <Text mb=\"2\">Please execute the following transactions:</Text>\n\n          <Multistep\n            step={1}\n            title=\"Withdraw\"\n            subtitle={\n              <Text as=\"div\">\n                <Amount value={amount} suffix={` ${accountCollateral?.symbol}`} /> will be withdrawn\n              </Text>\n            }\n            status={{\n              failed: Boolean(error?.step === State.withdraw),\n              disabled: amount.eq(0),\n              success: state.matches(State.unwrap) || state.matches(State.success),\n              loading: state.matches(State.withdraw) && !error,\n            }}\n          />\n          {accountCollateral?.symbol === 'WETH' ? (\n            <Multistep\n              step={2}\n              title={`Unwrap ${accountCollateral?.symbol}`}\n              subtitle=\"This will unwrap your WETH to ETH\"\n              status={{\n                failed: Boolean(error?.step === State.unwrap),\n                disabled: accountCollateral?.symbol !== 'WETH',\n                success: state.matches(State.success),\n                loading: state.matches(State.unwrap),\n              }}\n            />\n          ) : null}\n\n          <Button\n            isDisabled={isProcessing}\n            onClick={onSubmit}\n            width=\"100%\"\n            my=\"4\"\n            data-testid=\"withdraw confirm button\"\n          >\n            {(() => {\n              switch (true) {\n                case Boolean(error):\n                  return 'Retry';\n                case isProcessing:\n                  return 'Processing...';\n                case state.matches(State.success):\n                  return 'Done';\n                default:\n                  return 'Start';\n              }\n            })()}\n          </Button>\n        </ModalBody>\n      </ModalContent>\n    </Modal>\n  );\n};\n\nexport function WithdrawModal({\n  accountCollateral,\n  onClose,\n  isOpen,\n}: {\n  accountCollateral: AccountCollateralWithSymbol;\n  isOpen: boolean;\n  onClose: () => void;\n}) {\n  const params = useParams();\n  const toast = useToast({ isClosable: true, duration: 9000 });\n  const { network } = useNetwork();\n\n  const { exec: unwrap } = useUnWrapEth();\n\n  const { exec: execWithdraw } = useWithdraw({\n    accountId: params.accountId,\n    collateralTypeAddress: accountCollateral?.tokenAddress,\n    accountCollateral,\n  });\n\n  const queryClient = useQueryClient();\n\n  const { data: CoreProxy } = useCoreProxy();\n  const errorParserCoreProxy = useContractErrorParser(CoreProxy);\n\n  const [state, send] = useMachine(WithdrawMachine, {\n    context: {\n      amount: accountCollateral?.availableCollateral,\n    },\n    services: {\n      [ServiceNames.withdraw]: async () => {\n        try {\n          await execWithdraw();\n          await queryClient.invalidateQueries({\n            queryKey: [`${network?.id}-${network?.preset}`, 'AccountSpecificCollateral'],\n          });\n        } catch (error: any) {\n          const contractError = errorParserCoreProxy(error);\n          if (contractError) {\n            console.error(new Error(contractError.name), contractError);\n          }\n          toast.closeAll();\n          toast({\n            title: 'Withdraw failed',\n            description: contractError ? (\n              <ContractError contractError={contractError} />\n            ) : (\n              'Please try again.'\n            ),\n            status: 'error',\n          });\n          throw Error('Withdraw failed', { cause: error });\n        }\n      },\n      [ServiceNames.unwrap]: async () => {\n        try {\n          toast({\n            title: 'Unwrap',\n            description: 'Unwrapping WETH to ETH.',\n            status: 'info',\n          });\n\n          await unwrap(state.context.amount);\n        } catch (e) {\n          toast.closeAll();\n          toast({ title: 'Unwrap failed', description: 'Please try again.', status: 'error' });\n          throw Error('Unwrap failed', { cause: e });\n        }\n      },\n    },\n  });\n\n  const onSubmit = useCallback(async () => {\n    if (state.matches(State.success)) {\n      send(Events.RESET);\n      onClose();\n      return;\n    }\n    if (state.context.error) {\n      send(Events.RETRY);\n      return;\n    }\n    send(Events.RUN);\n  }, [onClose, send, state]);\n\n  return (\n    <WithdrawModalUi\n      amount={state.context.amount}\n      isOpen={isOpen}\n      onClose={onClose}\n      accountCollateral={accountCollateral}\n      state={state}\n      error={state.context.error}\n      onSubmit={onSubmit}\n    />\n  );\n}\n","import { WithdrawModal } from './WithdrawModal';\nexport * from './WithdrawModal';\nexport default WithdrawModal;\n"],"names":["Events","SET_AMOUNT","SET_COLLATERAL_SYMBOL","RETRY","RUN","SUCCESS","FAILURE","RESET","State","idle","withdraw","unwrap","failed","success","FailedSteps","ServiceNames","initialContext","amount","wei","error","collateralSymbol","undefined","WithdrawMachine","createMachine","id","initial","predictableActionArguments","context","on","target","actions","assign","_","_context","event","symbol","states","cond","gt","invoke","src","onError","data","step","onDone","c","useWithdraw","accountId","collateralTypeAddress","accountCollateral","txnState","dispatch","useReducer","reducer","initialState","CoreProxy","useCoreProxy","collateralPriceIds","useAllCollateralPriceIds","network","useNetwork","gasSpeed","useGasSpeed","signer","useSigner","provider","useProvider","mutation","useMutation","mutationFn","async","Error","availableCollateral","eq","walletAddress","getAddress","type","gasPricesPromised","getGasPrice","populatedTxnPromised","populateTransaction","BigNumber","from","toBN","collateralPriceCallsPromise","fetchPriceUpdates","isTestnet","then","signedData","priceUpdatesToPopulatedTx","gasPrices","populatedTxn","collateralPriceCalls","Promise","all","allCalls","concat","erc7412Tx","withERC7412","gasOptionsForTransaction","formatGasPriceForTransaction","gasLimit","txn","sendTransaction","payload","txnHash","hash","wait","settle","isLoading","isPending","exec","mutateAsync","WithdrawModalUi","isOpen","onClose","onSubmit","state","isProcessing","matches","_jsxs","Modal","size","closeOnOverlayClick","children","_jsx","ModalOverlay","ModalContent","bg","color","WithdrawIncrease","ModalHeader","ModalCloseButton","ModalBody","Text","mb","Multistep","title","subtitle","as","Amount","value","suffix","status","Boolean","disabled","loading","Button","isDisabled","onClick","width","my","WithdrawModal","params","useParams","toast","useToast","isClosable","duration","useUnWrapEth","execWithdraw","tokenAddress","queryClient","useQueryClient","errorParserCoreProxy","useContractErrorParser","send","useMachine","services","invalidateQueries","queryKey","preset","contractError","console","name","closeAll","description","ContractError","cause","e","useCallback"],"sourceRoot":""}