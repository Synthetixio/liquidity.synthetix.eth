"use strict";(globalThis.webpackChunk_snx_v3_liquidity=globalThis.webpackChunk_snx_v3_liquidity||[]).push([[9545],{49545:(e,t,a)=>{a.r(t),a.d(t,{UndelegateModal:()=>N,UndelegateModalUi:()=>K,default:()=>V});var l=a(11082),r=a(59176),o=a(74008),n=a(84626),s=a(70065),c=a(45071),i=a(99581),u=a(77528),d=a(13797),m=a(25042),h=a(76885),y=a(64996),C=a(97721),b=a(40109),g=a(89536),x=a(70332),p=a(42736),f=a(79929),v=a(28145),S=a(97737),j=a(2784),k=a(9875),w=a(97386);const T="SET_AMOUNT",A="SET_COLLATERAL_SYMBOL",E="RETRY",U="RUN",q="RESET",D="idle",I="undelegate",P="failed",_="success",G={[I]:I},M="undelegate",$={amount:(0,f.wei)(0),error:null,collateralSymbol:void 0},H=(0,k.C)({id:"UndelegateMachine",initial:D,predictableActionArguments:!0,context:$,on:{[q]:{target:D,actions:(0,w.f0)({amount:e=>$.amount,error:e=>$.error,collateralSymbol:e=>$.collateralSymbol})},[T]:{actions:(0,w.f0)({amount:(e,t)=>t.amount})},[A]:{actions:(0,w.f0)({collateralSymbol:(e,t)=>t.symbol})}},states:{[D]:{on:{[U]:[{target:I,cond:e=>e.amount.gt(0)}]}},[I]:{invoke:{src:M,onError:{target:P,actions:(0,w.f0)({error:(e,t)=>({error:t.data,step:G.undelegate})})},onDone:[{target:_}]}},[P]:{on:{[E]:[{target:I,cond:e=>e.error?.step===G.undelegate,actions:(0,w.f0)({error:e=>null})}]}},[_]:{}}});var L=a(75429),O=a(21849),R=a(88383),z=a(70895),Q=a(96596),Y=a(52465),B=a(81826),F=a(52322);const K=({txSummary:e,amount:t,isOpen:a,onClose:s,collateralType:i,onSubmit:u,state:d,error:h})=>{const y=d.matches(I);if(a)return d.matches(_)?(0,F.jsx)(O.s,{onClose:u,title:"Collateral successfully Updated",subline:(0,F.jsxs)(F.Fragment,{children:["Your ",(0,F.jsx)("b",{children:"Collateral"})," has been updated, read more about it in the"," ",(0,F.jsx)(l.r,{href:"https://docs.synthetix.io/v/synthetix-v3-user-documentation",target:"_blank",color:"cyan.500",children:"Synthetix V3 Documentation"})]}),alertText:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("b",{children:"Collateral"})," successfully Updated"]}),summary:e}):(0,F.jsxs)("div",{children:[(0,F.jsxs)(r.x,{color:"gray.50",fontSize:"20px",fontWeight:700,children:[(0,F.jsx)(L.R,{cursor:"pointer",onClick:s,mr:2}),"Manage Collateral"]}),(0,F.jsx)(o.i,{my:4}),(0,F.jsx)(m.P0,{step:1,title:"Unlock collateral",subtitle:(0,F.jsxs)(r.x,{as:"div",children:[(0,F.jsx)(c.$,{value:t,suffix:` ${i?.displaySymbol}`})," will be unlocked from the pool."]}),status:{failed:Boolean(h?.step===I),disabled:t.eq(0),success:d.matches(_),loading:d.matches(I)&&!h}}),(0,F.jsx)(n.z,{isDisabled:y,onClick:u,width:"100%",mt:"6","data-testid":"undelegate confirm button",children:(()=>{switch(!0){case Boolean(h):return"Retry";case y:return"Processing...";case d.matches(_):return"Continue";default:return"Execute Transaction"}})()})]})},N=({onClose:e,isOpen:t,liquidityPosition:a})=>{const l=(0,g.UO)(),{collateralChange:r,setCollateralChange:o}=(0,j.useContext)(d.n),{network:n}=(0,h.LN)(),c=(0,v.useQueryClient)(),{data:m}=(0,y.t)(l.collateralSymbol),k=(0,s.p)({isClosable:!0,duration:9e3}),[w,D]=(0,j.useState)({currentCollateral:R.GH,collateralChange:R.GH,currentDebt:R.GH}),I=a?.collateralAmount||(0,f.wei)(0),{exec:P}=(0,x.V)({accountId:l.accountId,poolId:l.poolId,collateralTypeAddress:a?.tokenAddress,collateralChange:r,currentCollateral:I}),{exec:G}=(0,p.G)({accountId:l.accountId,poolId:l.poolId,collateralTypeAddress:a?.tokenAddress,collateralChange:r,currentCollateral:I,liquidityPosition:a}),{data:$}=(0,b.a)(),L=(0,C.o)($),O=(0,u.Yz)(n?.id,n?.preset),[N,V]=(0,S.e)(H,{context:{amount:r.abs()},services:{[M]:async()=>{try{D({currentCollateral:I,currentDebt:a?.debt||R.GH,collateralChange:r}),O?await G():await P(),c.invalidateQueries({queryKey:[`${n?.id}-${n?.preset}`,"LiquidityPosition"],exact:!1}),c.invalidateQueries({queryKey:[`${n?.id}-${n?.preset}`,"LiquidityPositions"]}),c.invalidateQueries({queryKey:[`${n?.id}-${n?.preset}`,"AccountCollateralUnlockDate",{accountId:l.accountId}]}),o(R.GH)}catch(e){const t=L(e);throw t&&console.error(new Error(t.name),t),k.closeAll(),k({title:"Unlock collateral failed",description:t?(0,F.jsx)(i.M,{contractError:t}):"Please try again.",status:"error",variant:"left-accent"}),Error("Unlock collateral failed",{cause:e})}}}}),W=r.toString();(0,j.useEffect)((()=>{V(T,{amount:(0,f.wei)(W).abs()})}),[W,V]),(0,j.useEffect)((()=>{V(A,{symbol:(0,f.wei)(W).abs()})}),[W,V]);const X=(0,j.useCallback)((async()=>{if(N.matches(_))return V(q),void e();N.context.error?V(E):V(U)}),[e,V,N]),J=(0,j.useMemo)((()=>{const e=[{label:"Total "+m?.displaySymbol,value:(0,F.jsx)(z.DX,{value:w.currentCollateral,newValue:w.currentCollateral.add(w.collateralChange),formatFn:e=>(0,Q.Aq)(e),hasChanges:w.collateralChange.abs().gt(0),size:"sm"})}];return O?e:[...e,{label:"C-ratio",value:(0,F.jsx)(Y.p,{currentCollateral:w.currentCollateral,currentDebt:w.currentDebt,collateralChange:w.collateralChange,collateralPrice:a?.collateralPrice??R.GH,debtChange:R.GH,size:"sm"})}]}),[m?.displaySymbol,O,a?.collateralPrice,w.collateralChange,w.currentCollateral,w.currentDebt]);return(0,F.jsx)(K,{amount:N.context.amount,isOpen:t,onClose:e,collateralType:m,state:N,error:N.context.error,onSubmit:X,txSummary:(0,F.jsx)(B.v,{items:J})})},V=N}}]);
//# sourceMappingURL=9545.c766f813.js.map