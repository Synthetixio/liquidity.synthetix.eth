{"version":3,"file":"chunk/3967.010795d8.js","mappings":"kjBA8BA,SAASA,GAAS,UAAEC,EAAS,SAAEC,IAC7B,OAAQD,GACN,IAAK,QACH,OAAOE,EAAAA,EAAAA,KAACC,EAAAA,GAAS,CAACC,MAAM,UAC1B,IAAK,UACH,OAAOF,EAAAA,EAAAA,KAACG,EAAAA,GAAS,CAACD,MAAM,UAC1B,IAAK,YACL,IAAK,UACH,OAAOF,EAAAA,EAAAA,KAACI,EAAAA,EAAO,CAACF,MAAM,QAAQG,MAAO,EAAGC,OAAQ,IAClD,QACE,OACEN,EAAAA,EAAAA,KAACO,EAAAA,GAAG,CACFC,MAAO,CACLC,QAAS,SACTC,WAAY,SACZC,UAAW,SACXC,SAAU,MACVb,SAEDA,IAIX,CAEA,MAAMc,EAAef,GACD,UAAdA,GAAuC,YAAdA,EAAgCA,EACtD,WAGIgB,EAMRA,EAAGC,UAASC,SAAQC,aAAYnB,YAAWoB,iBAC9C,MAAM,QAAEC,IAAYC,EAAAA,EAAAA,MACdC,GAASC,EAAAA,EAAAA,IAAgBH,GAASI,GAAIJ,GAASK,QAErD,OACEC,EAAAA,EAAAA,MAACC,EAAAA,GAAK,CAACC,KAAK,KAAKX,OAAQA,EAAQD,QAASA,EAASa,qBAAqB,EAAM7B,SAAA,EAC5EC,EAAAA,EAAAA,KAAC6B,EAAAA,EAAY,CAACxB,MAAM,OAAOC,OAAO,UAClCmB,EAAAA,EAAAA,MAACK,EAAAA,EAAY,CAACC,GAAG,QAAQ7B,MAAM,QAAQ,cAAY,eAAcH,SAAA,EAC/DC,EAAAA,EAAAA,KAACgC,EAAAA,EAAW,CAAAjC,SAAC,0BACbC,EAAAA,EAAAA,KAACiC,EAAAA,EAAgB,KACjBR,EAAAA,EAAAA,MAACS,EAAAA,EAAS,CAAAnC,SAAA,EACR0B,EAAAA,EAAAA,MAACU,EAAAA,EAAI,CACHC,IAAK,EACLC,WAAW,SACXC,QAAQ,KACRC,EAAE,IACFC,OAAO,YACPC,mBAAmB,eACnBC,mBAAmB,SACnBC,YAAa9B,EAAYf,GAAWC,SAAA,EAEpCC,EAAAA,EAAAA,KAACmC,EAAAA,EAAI,CACH9B,MAAO,GACPC,OAAQ,GACRsC,eAAe,SACfP,WAAW,SACXN,GAAIlB,EAAYf,GAChBwC,QAAQ,OACRG,mBAAmB,aACnBC,mBAAmB,SAAQ3C,UAE3BC,EAAAA,EAAAA,KAACH,EAAQ,CAACC,UAAWA,EAAUC,SAAC,SAElC0B,EAAAA,EAAAA,MAACoB,EAAAA,EAAI,CAAA9C,SAAA,CACFsB,EAAS,QAAU,SAAU,KAC9BrB,EAAAA,EAAAA,KAAC8C,EAAAA,EAAM,CAACC,MAAO9B,EAAY+B,OAAQ3B,EAAS,QAAU,mBAG1DrB,EAAAA,EAAAA,KAACiD,EAAAA,EAAM,CACLC,WAA0B,YAAdpD,EACZqD,QAASA,KACW,WAAdrD,GACFoB,IAEgB,YAAdpB,GACFiB,GACF,EAEFV,MAAM,OACN+C,GAAG,IACH,cAAY,wBAAuBrD,SAElC,MACC,OAAQD,GACN,IAAK,QACH,MAAO,QACT,IAAK,UACH,MAAO,gBACT,IAAK,UACH,MAAO,OACT,QACE,MAAO,QAEZ,EAXA,aAeD,EAICuD,EAGRA,EAAGtC,UAASC,aACf,MAAM,WAAEC,IAAeqC,EAAAA,EAAAA,YAAWC,EAAAA,GAC5BC,GAAcC,EAAAA,EAAAA,kBACdC,GAASC,EAAAA,EAAAA,OACPC,KAAMC,IAAmBC,EAAAA,EAAAA,GAAkBJ,EAAOK,mBAGxDC,KAAM9C,EAAU,SAChB+C,EACAC,OAAQC,GCvIaC,GACvBC,YACAC,SACAC,wBACAtD,iBAOA,MAAOgD,EAAUO,IAAYC,EAAAA,EAAAA,YAAWC,EAAAA,EAASC,EAAAA,IACzCf,KAAMgB,IAAcC,EAAAA,EAAAA,MACpBjB,KAAMkB,IAAuBC,EAAAA,EAAAA,KAE/BC,GAASC,EAAAA,EAAAA,OACT,SAAEC,IAAaC,EAAAA,EAAAA,MACfC,GAAWC,EAAAA,EAAAA,OACX,QAAElE,IAAYC,EAAAA,EAAAA,MAEdkE,GAAWC,EAAAA,EAAAA,aAAY,CAC3BC,WAAYC,UACV,GAEIT,GACAJ,GACAN,GACAD,GACAE,GACAO,GACA3D,GACAiE,IAIAnE,EAAWyE,GAAG,GAElB,IACElB,EAAS,CAAEmB,KAAM,cAEjB,MAAMC,EAAuBhB,EAAUiB,oBAAoBC,QACzDC,EAAAA,GAAUC,KAAK3B,GACf0B,EAAAA,GAAUC,KAAK1B,GACfC,EACAtD,EAAWgF,QAEPC,QAAsBlB,EAAOmB,aAC7BC,GAA8BC,EAAAA,EAAAA,GAClCvB,EACA3D,EAAQmF,WACRC,MAAMC,IACNC,EAAAA,EAAAA,GAA0BP,EAAepB,EAAoB0B,MAGxDE,EAAOC,EAAWC,SAA8BC,QAAQC,IAAI,CACjElB,GACAmB,EAAAA,EAAAA,GAAY,CAAE3B,aACdgB,IAEIY,EAAWJ,EAAqBK,OAAOP,GAEvCQ,QAAkBC,EAAAA,EAAAA,IAAYhG,EAAS6F,EAAU,SAAUpC,EAAUwC,WAErEC,GAA2BC,EAAAA,EAAAA,GAA6B,CAC5DC,SAAUL,EAAUK,SACpBZ,YACAzB,aAGIsC,QAAYxC,EAAOyC,gBAAgB,IAAKP,KAAcG,IAE5D7C,EAAS,CAAEmB,KAAM,UAAW+B,QAAS,CAAEC,QAASH,EAAII,cAE9CJ,EAAIK,OACVrD,EAAS,CAAEmB,KAAM,WACnB,CAAE,MAAOmC,GAEP,MADAtD,EAAS,CAAEmB,KAAM,QAAS+B,QAAS,CAAEI,WAC/BA,CACR,KAGJ,MAAO,CACLxC,WACArB,WACAC,OAAQA,IAAMM,EAAS,CAAEmB,KAAM,YAC/BoC,UAAWzC,EAAS0C,UACpBhE,KAAMsB,EAAS2C,YAChB,EDiDG7D,CAAU,CACZC,UAAWX,EAAOW,UAClBC,OAAQZ,EAAOY,OACfC,sBAAuBV,GAAgBqE,aACvCjH,eAGIkH,GAAQC,EAAAA,EAAAA,GAAS,CAAEC,YAAY,EAAMC,SAAU,OAC7C1E,KAAMgB,IAAcC,EAAAA,EAAAA,MACtB,QAAE1D,IAAYC,EAAAA,EAAAA,MACdmH,GAAuBC,EAAAA,EAAAA,GAAuB5D,GAC9C6D,GAA4BC,EAAAA,EAAAA,cAAYjD,UAC5C,UACQvE,UACAsC,EAAYmF,kBAAkB,CAClCC,SAAU,CAAC,GAAGzH,GAASI,MAAMJ,GAASK,SAAU,qBAChDqH,OAAO,GAEX,CAAE,MAAOf,GACP,MAAMgB,EAAgBP,EAAqBT,GAc3C,MAbIgB,GACFC,QAAQjB,MAAM,IAAIkB,MAAMF,EAAcG,MAAOH,GAE/CX,EAAMe,WACNf,EAAM,CACJgB,MAAO,gBACPC,YAAaN,GACX9I,EAAAA,EAAAA,KAACqJ,EAAAA,EAAa,CAACP,cAAeA,IAE9B,oBAEFQ,OAAQ,UAEJN,MAAM,gBAAiB,CAAEO,MAAOzB,GACxC,IACC,CAAC5G,EAAYsC,EAAarC,GAASI,GAAIJ,GAASK,OAAQ+G,EAAsBJ,KAE3E,UAAErI,GAAcmE,EAEtB,OAAKP,EAAOY,QAAWZ,EAAOW,WAAcR,GAG1C7D,EAAAA,EAAAA,KAACc,EAAa,CACZI,WAAYuH,EACZxH,WAAYA,EACZnB,UAAWA,EACXiB,QAASA,KACPoD,IACApD,GAAS,EAEXC,OAAQA,IAXuD,IAY/D,EEvMN,G,wGCGA,MAAMwI,EAA4D,SAA9CC,QAAQC,cAAcC,oBAEnC,SAASN,GAAc,cAAEP,IAC9B,MAAO9H,EAAQ4I,GAAaC,EAAAA,SAAeL,GAE3C,OACE/H,EAAAA,EAAAA,MAAAqI,EAAAA,SAAA,CAAA/J,SAAA,CACIiB,EAUE,MATFhB,EAAAA,EAAAA,KAACiD,EAAAA,EAAM,CACL8G,QAAQ,OACR5G,QAASA,IAAMyG,GAAU,GACzB1J,MAAM,UACNQ,WAAW,SACXsJ,UAAU,SAAQjK,SACnB,gBAIH0B,EAAAA,EAAAA,MAACwI,EAAAA,EAAQ,CAACC,GAAIlJ,EAAQmJ,gBAAc,EAAApK,SAAA,EAClCC,EAAAA,EAAAA,KAAC6C,EAAAA,EAAI,CAACmH,UAAU,SAASpJ,SAAS,QAAOb,SACtC+I,EAAcG,QAEjBjJ,EAAAA,EAAAA,KAAC6C,EAAAA,EAAI,CAACuH,WAAW,MAAMxJ,SAAS,QAAQoJ,UAAU,SAASK,GAAG,QAAOtK,SAClEuK,OAAOC,QAAQzB,EAAc0B,MAC3BC,KACC,EAAEC,EAAKC,KACL,GAAGD,MAAQC,aAAeC,MAAOC,EAAAA,EAAAA,GAAOF,EAAK,uBAAyBA,MAEzEG,KAAK,aAKlB,C,iHChCO,MAAM3K,GAAY4K,EAAAA,EAAAA,GAAW,CAClCC,QAAS,YACTC,MACEjL,EAAAA,EAAAA,KAAA,KAAGkL,KAAK,eAAcnL,UACpBC,EAAAA,EAAAA,KAAA,WAASmL,OAAO,sFAKTlL,GAAY8K,EAAAA,EAAAA,GAAW,CAClCK,EAAG,qRAGE,SAASvL,GAAS,OAAEyJ,EAAM,SAAEvJ,IACjC,QAAQ,GACN,KAAKuJ,EAAO+B,OACV,OAAOrL,EAAAA,EAAAA,KAACC,EAAS,CAACC,MAAM,UAC1B,KAAKoJ,EAAOgC,QACV,OAAOtL,EAAAA,EAAAA,KAACG,EAAS,CAACD,MAAM,UAC1B,KAAKoJ,EAAOiC,QACV,OAAOvL,EAAAA,EAAAA,KAACI,EAAAA,EAAO,CAACF,MAAM,QAAQG,MAAO,EAAGC,OAAQ,IAClD,KAAKgJ,EAAOkC,SACZ,QACE,OACExL,EAAAA,EAAAA,KAACO,EAAAA,GAAG,CACFC,MAAO,CACLC,QAAS,SACTC,WAAY,SACZC,UAAW,SACXC,SAAU,MACVb,SAEDA,IAIX,CCxCO,SAASc,EAAYyI,GAC1B,QAAQ,GAEN,KAAKA,EAAO+B,OACV,MAAO,UACT,KAAK/B,EAAOkC,SAEZ,KAAKlC,EAAOiC,QACV,MAAO,WACT,KAAKjC,EAAOgC,QACV,MAAO,YACT,QACE,MAAO,WAEb,CCVO,SAASG,GAAK,OAAEnC,EAAM,SAAEvJ,IAC7B,OACEC,EAAAA,EAAAA,KAACmC,EAAAA,EAAI,CACH9B,MAAO,GACPC,OAAQ,GACRoL,SAAU,GACVC,UAAW,GACX/I,eAAe,SACfP,WAAW,SACXN,GAAIlB,EAAYyI,GAChBhH,QAAQ,OACRG,mBAAmB,aACnBC,mBAAmB,SAAQ3C,UAE3BC,EAAAA,EAAAA,KAACH,EAAQ,CAACyJ,OAAQA,EAAOvJ,SAAEA,KAGjC,C,0BCjBA,SAAS6L,GAAa,SAAE7L,KAAa8L,IACnC,OACE7L,EAAAA,EAAAA,KAACmC,EAAAA,EAAI,CAAC2J,GAAG,MAAK/L,UACZC,EAAAA,EAAAA,KAAC+L,EAAAA,EAAQ,CAACpK,KAAK,QAASkK,EAAK9L,UAC3BC,EAAAA,EAAAA,KAACO,EAAAA,GAAG,CAACK,SAAS,KAAKoL,QAAQ,OAAMjM,SAC9BA,OAKX,CAEO,SAASkM,GAAU,KACxBC,EAAI,MACJ/C,EAAK,SACLgD,EAAQ,cACRC,EAAa,cACbC,EAAa,OACb/C,EAAM,SACNvJ,IASA,OACE0B,EAAAA,EAAAA,MAACU,EAAAA,EAAI,CACHmK,SAAS,WACTjK,WAAW,SACXD,IAAK,EACLE,QAAQ,KACRwJ,GAAG,IACHvJ,EAAE,IACFC,OAAO,YACPC,mBAAmB,eACnBC,mBAAmB,SACnBC,YAAa9B,EAAYyI,GAAQvJ,SAAA,EAEjCC,EAAAA,EAAAA,KAACyL,EAAI,CAACnC,OAAQA,EAAOvJ,SAAEmM,KACvBzK,EAAAA,EAAAA,MAACU,EAAAA,EAAI,CAACoK,UAAU,SAAQxM,SAAA,EACtBC,EAAAA,EAAAA,KAAC6C,EAAAA,EAAI,CAAC,UAAS,aAAaqJ,IAAOnM,SAAEoJ,IACpCgD,GACCnM,EAAAA,EAAAA,KAAC6C,EAAAA,EAAI,CAAC2J,GAAG,MAAM5L,SAAS,KAAKoL,QAAQ,OAAMjM,SACxCoM,IAED,KACHC,GAAgBpM,EAAAA,EAAAA,KAAC4L,EAAY,IAAKS,EAAatM,SAAGqM,IAAgC,KAClFrM,OAIT,C,qPCjDO,SAASyI,EAAuBiE,GACrC,OAAO/D,EAAAA,EAAAA,cACJZ,IACC,GAAK2E,EAGL,IACE,MAAMC,EAAY5E,GAAOA,OAAOlE,MAAMA,MAAQkE,GAAOA,OAAOA,OAAOlE,KACnE,IAAK8I,EAEH,YADA3D,QAAQjB,MAAM,CAAEA,UAIlB,MAAM6E,EAAcF,EAASrF,UAAUyD,OAAO+B,EAAAA,GAAkBC,MAiB1DC,EAhBc,IAAIC,EAAAA,GACtBN,EAASO,QACTC,MAAMjH,KACJ,IAAIkH,IACFP,EAAY1F,OAAOkG,EAAAA,IAAalG,OAAO,CAErC,wCACA,+CACA,mCACA,sCACA,2CAINwF,EAASzH,QAAUyH,EAASrH,UAEEgC,UAAUgG,WAAWV,GAC/CW,EAAY/C,OAAOgD,YACvBhD,OAAOC,QAAQuC,EAAYtC,MACxB+C,QAAO,EAAE7C,KAAS,GAAG8C,SAAS9C,OAAWA,IACzCD,KAAI,EAAEC,EAAK3H,MACV,GAAIA,aAAiBgK,EAAAA,GAAkB,CAErC,MAAMU,EAAQC,WAAWX,EAAAA,GAAyBhK,EAAM4K,aACxD,OAAIF,EAAQ,KAEH,CAAC/C,EAAK+C,GAKb1K,EAAM6K,WAAa,IAAIhD,KAAK,IAAM,EAAG,GAAGiD,UAAY,KACpD9K,EAAM6K,WAAa,IAAIhD,KAAK,KAAM,EAAG,GAAGiD,UAAY,IAE7C,CAACnD,EAAK,IAAIE,KAAwB,IAAnB7H,EAAM6K,aAIvB,CAAClD,EAAKgD,WAAW3K,EAAM4K,YAChC,CAGA,MAAO,CAACjD,EAAK3H,EAAM,KAIzB,MAAO,CACLa,KAAM8I,EACNzD,KAAM6D,EAAY7D,KAClB6E,UAAWhB,EAAYgB,UACvBtD,KAAM6C,EAEV,CAAE,MAAOU,GAEP,YADAhF,QAAQjB,MAAMiG,EAEhB,IAEF,CAACtB,GAEL,C","sources":["webpack://@snx-v3/liquidity/../components/BorrowModal/BorrowModal.tsx","webpack://@snx-v3/liquidity/../lib/useBorrow/useBorrow.tsx","webpack://@snx-v3/liquidity/../components/BorrowModal/index.ts","webpack://@snx-v3/liquidity/../components/ContractError/ContractError.tsx","webpack://@snx-v3/liquidity/../components/Multistep/StepIcon.tsx","webpack://@snx-v3/liquidity/../components/Multistep/statusColor.ts","webpack://@snx-v3/liquidity/../components/Multistep/Step.tsx","webpack://@snx-v3/liquidity/../components/Multistep/Multistep.tsx","webpack://@snx-v3/liquidity/../lib/useContractErrorParser/useContractErrorParser.ts"],"sourcesContent":["import {\n  Box,\n  Button,\n  Flex,\n  Modal,\n  ModalBody,\n  ModalCloseButton,\n  ModalContent,\n  ModalHeader,\n  ModalOverlay,\n  Spinner,\n  Text,\n  useToast,\n} from '@chakra-ui/react';\nimport { Amount } from '@snx-v3/Amount';\nimport Wei from '@synthetixio/wei';\nimport { TransactionStatus } from '@snx-v3/txnReducer';\nimport { CheckIcon, CloseIcon } from '@snx-v3/Multistep';\nimport { PropsWithChildren, useCallback, useContext } from 'react';\nimport { useParams } from '@snx-v3/useParams';\nimport { ManagePositionContext } from '@snx-v3/ManagePositionContext';\nimport { useCollateralType } from '@snx-v3/useCollateralTypes';\nimport { useCoreProxy } from '@snx-v3/useCoreProxy';\nimport { useContractErrorParser } from '@snx-v3/useContractErrorParser';\nimport { ContractError } from '@snx-v3/ContractError';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { useNetwork } from '@snx-v3/useBlockchain';\nimport { useBorrow } from '@snx-v3/useBorrow';\nimport { isBaseAndromeda } from '@snx-v3/isBaseAndromeda';\n\nfunction StepIcon({ txnStatus, children }: PropsWithChildren<{ txnStatus: TransactionStatus }>) {\n  switch (txnStatus) {\n    case 'error':\n      return <CloseIcon color=\"white\" />;\n    case 'success':\n      return <CheckIcon color=\"white\" />;\n    case 'prompting':\n    case 'pending':\n      return <Spinner color=\"white\" width={6} height={6} />;\n    default:\n      return (\n        <Box\n          __css={{\n            display: 'inline',\n            fontWeight: 'medium',\n            textAlign: 'center',\n            fontSize: 'md',\n          }}\n        >\n          {children}\n        </Box>\n      );\n  }\n}\n\nconst statusColor = (txnStatus: TransactionStatus) => {\n  if (txnStatus === 'error' || txnStatus === 'success') return txnStatus;\n  return 'gray.700';\n};\n\nexport const BorrowModalUi: React.FC<{\n  onClose: () => void;\n  debtChange: Wei;\n  isOpen: boolean;\n  txnStatus: TransactionStatus;\n  execBorrow: () => void;\n}> = ({ onClose, isOpen, debtChange, txnStatus, execBorrow }) => {\n  const { network } = useNetwork();\n  const isBase = isBaseAndromeda(network?.id, network?.preset);\n\n  return (\n    <Modal size=\"lg\" isOpen={isOpen} onClose={onClose} closeOnOverlayClick={false}>\n      <ModalOverlay width=\"100%\" height=\"100%\" />\n      <ModalContent bg=\"black\" color=\"white\" data-testid=\"borrow modal\">\n        <ModalHeader>Complete this action</ModalHeader>\n        <ModalCloseButton />\n        <ModalBody>\n          <Flex\n            gap={2}\n            alignItems=\"center\"\n            rounded=\"lg\"\n            p=\"4\"\n            border=\"2px solid\"\n            transitionProperty=\"border-color\"\n            transitionDuration=\"normal\"\n            borderColor={statusColor(txnStatus)}\n          >\n            <Flex\n              width={10}\n              height={10}\n              justifyContent=\"center\"\n              alignItems=\"center\"\n              bg={statusColor(txnStatus)}\n              rounded=\"full\"\n              transitionProperty=\"background\"\n              transitionDuration=\"normal\"\n            >\n              <StepIcon txnStatus={txnStatus}>1</StepIcon>\n            </Flex>\n            <Text>\n              {isBase ? 'Claim' : 'Borrow'}{' '}\n              <Amount value={debtChange} suffix={isBase ? ' USDC' : ' snxUSD'} />\n            </Text>\n          </Flex>\n          <Button\n            isDisabled={txnStatus === 'pending'}\n            onClick={() => {\n              if (txnStatus === 'unsent') {\n                execBorrow();\n              }\n              if (txnStatus === 'success') {\n                onClose();\n              }\n            }}\n            width=\"100%\"\n            my=\"4\"\n            data-testid=\"borrow confirm button\"\n          >\n            {(() => {\n              switch (txnStatus) {\n                case 'error':\n                  return 'Retry';\n                case 'pending':\n                  return 'Processing...';\n                case 'success':\n                  return 'Done';\n                default:\n                  return 'Start';\n              }\n            })()}\n          </Button>\n        </ModalBody>\n      </ModalContent>\n    </Modal>\n  );\n};\n\nexport const BorrowModal: React.FC<{\n  onClose: () => void;\n  isOpen: boolean;\n}> = ({ onClose, isOpen }) => {\n  const { debtChange } = useContext(ManagePositionContext);\n  const queryClient = useQueryClient();\n  const params = useParams();\n  const { data: collateralType } = useCollateralType(params.collateralSymbol);\n\n  const {\n    exec: execBorrow,\n    txnState,\n    settle: settleBorrow,\n  } = useBorrow({\n    accountId: params.accountId,\n    poolId: params.poolId,\n    collateralTypeAddress: collateralType?.tokenAddress,\n    debtChange,\n  });\n\n  const toast = useToast({ isClosable: true, duration: 9000 });\n  const { data: CoreProxy } = useCoreProxy();\n  const { network } = useNetwork();\n  const errorParserCoreProxy = useContractErrorParser(CoreProxy);\n  const execBorrowWithErrorParser = useCallback(async () => {\n    try {\n      await execBorrow();\n      await queryClient.invalidateQueries({\n        queryKey: [`${network?.id}-${network?.preset}`, 'LiquidityPosition'],\n        exact: false,\n      });\n    } catch (error: any) {\n      const contractError = errorParserCoreProxy(error);\n      if (contractError) {\n        console.error(new Error(contractError.name), contractError);\n      }\n      toast.closeAll();\n      toast({\n        title: 'Borrow failed',\n        description: contractError ? (\n          <ContractError contractError={contractError} />\n        ) : (\n          'Please try again.'\n        ),\n        status: 'error',\n      });\n      throw Error('Borrow failed', { cause: error });\n    }\n  }, [execBorrow, queryClient, network?.id, network?.preset, errorParserCoreProxy, toast]);\n\n  const { txnStatus } = txnState;\n\n  if (!params.poolId || !params.accountId || !collateralType) return null;\n\n  return (\n    <BorrowModalUi\n      execBorrow={execBorrowWithErrorParser}\n      debtChange={debtChange}\n      txnStatus={txnStatus}\n      onClose={() => {\n        settleBorrow();\n        onClose();\n      }}\n      isOpen={isOpen}\n    />\n  );\n};\n","import { useReducer } from 'react';\nimport { useCoreProxy } from '@snx-v3/useCoreProxy';\nimport { useMutation } from '@tanstack/react-query';\nimport { useNetwork, useProvider, useSigner } from '@snx-v3/useBlockchain';\nimport { initialState, reducer } from '@snx-v3/txnReducer';\nimport Wei from '@synthetixio/wei';\nimport { BigNumber } from 'ethers';\nimport { formatGasPriceForTransaction } from '@snx-v3/useGasOptions';\nimport { getGasPrice } from '@snx-v3/useGasPrice';\nimport { useGasSpeed } from '@snx-v3/useGasSpeed';\nimport { withERC7412 } from '@snx-v3/withERC7412';\nimport { useAllCollateralPriceIds } from '@snx-v3/useAllCollateralPriceIds';\nimport { fetchPriceUpdates, priceUpdatesToPopulatedTx } from '@snx-v3/fetchPythPrices';\n\nexport const useBorrow = ({\n  accountId,\n  poolId,\n  collateralTypeAddress,\n  debtChange,\n}: {\n  accountId?: string;\n  poolId?: string;\n  collateralTypeAddress?: string;\n  debtChange: Wei;\n}) => {\n  const [txnState, dispatch] = useReducer(reducer, initialState);\n  const { data: CoreProxy } = useCoreProxy();\n  const { data: collateralPriceIds } = useAllCollateralPriceIds();\n\n  const signer = useSigner();\n  const { gasSpeed } = useGasSpeed();\n  const provider = useProvider();\n  const { network } = useNetwork();\n\n  const mutation = useMutation({\n    mutationFn: async () => {\n      if (\n        !(\n          signer &&\n          CoreProxy &&\n          poolId &&\n          accountId &&\n          collateralTypeAddress &&\n          collateralPriceIds &&\n          network &&\n          provider\n        )\n      )\n        return;\n      if (debtChange.eq(0)) return;\n\n      try {\n        dispatch({ type: 'prompting' });\n\n        const populatedTxnPromised = CoreProxy.populateTransaction.mintUsd(\n          BigNumber.from(accountId),\n          BigNumber.from(poolId),\n          collateralTypeAddress,\n          debtChange.toBN()\n        );\n        const walletAddress = await signer.getAddress();\n        const collateralPriceCallsPromise = fetchPriceUpdates(\n          collateralPriceIds,\n          network.isTestnet\n        ).then((signedData) =>\n          priceUpdatesToPopulatedTx(walletAddress, collateralPriceIds, signedData)\n        );\n\n        const [calls, gasPrices, collateralPriceCalls] = await Promise.all([\n          populatedTxnPromised,\n          getGasPrice({ provider }),\n          collateralPriceCallsPromise,\n        ]);\n        const allCalls = collateralPriceCalls.concat(calls);\n\n        const erc7412Tx = await withERC7412(network, allCalls, 'borrow', CoreProxy.interface);\n\n        const gasOptionsForTransaction = formatGasPriceForTransaction({\n          gasLimit: erc7412Tx.gasLimit,\n          gasPrices,\n          gasSpeed,\n        });\n\n        const txn = await signer.sendTransaction({ ...erc7412Tx, ...gasOptionsForTransaction });\n\n        dispatch({ type: 'pending', payload: { txnHash: txn.hash } });\n\n        await txn.wait();\n        dispatch({ type: 'success' });\n      } catch (error: any) {\n        dispatch({ type: 'error', payload: { error } });\n        throw error;\n      }\n    },\n  });\n  return {\n    mutation,\n    txnState,\n    settle: () => dispatch({ type: 'settled' }),\n    isLoading: mutation.isPending,\n    exec: mutation.mutateAsync,\n  };\n};\n","import { BorrowModal } from './BorrowModal';\nexport * from './BorrowModal';\nexport default BorrowModal;\n","import React from 'react';\nimport { Button, Collapse, Text } from '@chakra-ui/react';\nimport format from 'date-fns/format';\nimport { ContractErrorType } from '@snx-v3/useContractErrorParser';\n\nconst defaultOpen = window?.localStorage?.CONTRACT_ERROR_OPEN === 'true';\n\nexport function ContractError({ contractError }: { contractError: ContractErrorType }) {\n  const [isOpen, setIsOpen] = React.useState(defaultOpen);\n\n  return (\n    <>\n      {!isOpen ? (\n        <Button\n          variant=\"link\"\n          onClick={() => setIsOpen(true)}\n          color=\"inherit\"\n          fontWeight=\"normal\"\n          fontStyle=\"italic\"\n        >\n          details...\n        </Button>\n      ) : null}\n      <Collapse in={isOpen} animateOpacity>\n        <Text fontStyle=\"italic\" fontSize=\"0.8em\">\n          {contractError.name}\n        </Text>\n        <Text whiteSpace=\"pre\" fontSize=\"0.8em\" fontStyle=\"italic\" pl=\"0.5em\">\n          {Object.entries(contractError.args)\n            .map(\n              ([key, val]) =>\n                `${key}: ${val instanceof Date ? format(val, 'yyyy-MM-dd HH:mm:ss') : val}`\n            )\n            .join('\\n')}\n        </Text>\n      </Collapse>\n    </>\n  );\n}\n","import { Box, Spinner } from '@chakra-ui/react';\nimport { PropsWithChildren } from 'react';\nimport { MultistepStatus } from './MultistepStatus';\n\nimport { createIcon } from '@chakra-ui/icon';\n\nexport const CheckIcon = createIcon({\n  viewBox: '0 0 14 14',\n  path: (\n    <g fill=\"currentColor\">\n      <polygon points=\"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039\" />\n    </g>\n  ),\n});\n\nexport const CloseIcon = createIcon({\n  d: 'M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z',\n});\n\nexport function StepIcon({ status, children }: PropsWithChildren<{ status: MultistepStatus }>) {\n  switch (true) {\n    case status.failed:\n      return <CloseIcon color=\"white\" />;\n    case status.success:\n      return <CheckIcon color=\"white\" />;\n    case status.loading:\n      return <Spinner color=\"white\" width={6} height={6} />;\n    case status.disabled:\n    default:\n      return (\n        <Box\n          __css={{\n            display: 'inline',\n            fontWeight: 'medium',\n            textAlign: 'center',\n            fontSize: 'md',\n          }}\n        >\n          {children}\n        </Box>\n      );\n  }\n}\n","import { MultistepStatus } from './MultistepStatus';\n\nexport function statusColor(status: MultistepStatus): string {\n  switch (true) {\n    // order matters\n    case status.failed:\n      return 'red.700';\n    case status.disabled:\n      return 'gray.700';\n    case status.loading:\n      return 'gray.700';\n    case status.success:\n      return 'green.700';\n    default:\n      return 'gray.700';\n  }\n}\n","import { Flex } from '@chakra-ui/react';\nimport { PropsWithChildren } from 'react';\nimport { MultistepStatus } from './MultistepStatus';\nimport { StepIcon } from './StepIcon';\nimport { statusColor } from './statusColor';\n\nexport function Step({ status, children }: PropsWithChildren<{ status: MultistepStatus }>) {\n  return (\n    <Flex\n      width={10}\n      height={10}\n      minWidth={10}\n      minHeight={10}\n      justifyContent=\"center\"\n      alignItems=\"center\"\n      bg={statusColor(status)}\n      rounded=\"full\"\n      transitionProperty=\"background\"\n      transitionDuration=\"normal\"\n    >\n      <StepIcon status={status}>{children}</StepIcon>\n    </Flex>\n  );\n}\n","import { PropsWithChildren, ReactElement } from 'react';\nimport { Box, Checkbox, CheckboxProps, Flex, Text } from '@chakra-ui/react';\nimport { Step } from './Step';\nimport { statusColor } from './statusColor';\nimport { MultistepStatus } from './MultistepStatus';\n\nfunction StepCheckbox({ children, ...props }: PropsWithChildren<CheckboxProps>) {\n  return (\n    <Flex mt=\"0.5\">\n      <Checkbox size=\"sm\" {...props}>\n        <Box fontSize=\"xs\" opacity=\"0.66\">\n          {children}\n        </Box>\n      </Checkbox>\n    </Flex>\n  );\n}\n\nexport function Multistep({\n  step,\n  title,\n  subtitle,\n  checkboxLabel,\n  checkboxProps,\n  status,\n  children,\n}: PropsWithChildren<{\n  step: number;\n  title: string | ReactElement;\n  subtitle?: string | ReactElement;\n  checkboxLabel?: string;\n  checkboxProps?: CheckboxProps;\n  status: MultistepStatus;\n}>) {\n  return (\n    <Flex\n      position=\"relative\"\n      alignItems=\"center\"\n      gap={4}\n      rounded=\"lg\"\n      mt=\"4\"\n      p=\"4\"\n      border=\"2px solid\"\n      transitionProperty=\"border-color\"\n      transitionDuration=\"normal\"\n      borderColor={statusColor(status)}\n    >\n      <Step status={status}>{step}</Step>\n      <Flex direction=\"column\">\n        <Text data-cy={`multistep-${step}`}>{title}</Text>\n        {subtitle ? (\n          <Text as=\"div\" fontSize=\"xs\" opacity=\"0.66\">\n            {subtitle}\n          </Text>\n        ) : null}\n        {checkboxLabel ? <StepCheckbox {...checkboxProps}>{checkboxLabel}</StepCheckbox> : null}\n        {children}\n      </Flex>\n    </Flex>\n  );\n}\n","import { ethers, utils } from 'ethers';\nimport { useCallback } from 'react';\nimport { ERC7412_ABI } from '@snx-v3/withERC7412';\n\nexport type ContractErrorType = {\n  data: string;\n  name: string;\n  signature: string;\n  args: Record<string, any>;\n};\n\nexport function useContractErrorParser(Contract?: ethers.Contract) {\n  return useCallback(\n    (error: any): ContractErrorType | undefined => {\n      if (!Contract) {\n        return undefined;\n      }\n      try {\n        const errorData = error?.error?.data?.data || error?.error?.error?.data; // add more options as we find them\n        if (!errorData) {\n          console.error({ error }); // intentional logging as object so we can inspect all properties\n          return undefined;\n        }\n\n        const contractAbi = Contract.interface.format(utils.FormatTypes.full) as string[];\n        const newContract = new ethers.Contract(\n          Contract.address,\n          Array.from(\n            new Set(\n              contractAbi.concat(ERC7412_ABI).concat([\n                // ERC721 errors\n                'error CannotSelfApprove(address addr)',\n                'error InvalidTransferRecipient(address addr)',\n                'error InvalidOwner(address addr)',\n                'error TokenDoesNotExist(uint256 id)',\n                'error TokenAlreadyMinted(uint256 id)',\n              ])\n            )\n          ), // uniq\n          Contract.signer || Contract.provider\n        );\n        const errorParsed = newContract.interface.parseError(errorData);\n        const errorArgs = Object.fromEntries(\n          Object.entries(errorParsed.args)\n            .filter(([key]) => `${parseInt(key)}` !== key)\n            .map(([key, value]) => {\n              if (value instanceof ethers.BigNumber) {\n                // Guess wei\n                const unwei = parseFloat(ethers.utils.formatEther(value.toString()));\n                if (unwei > 0.001) {\n                  // must be wei\n                  return [key, unwei];\n                }\n\n                // Guess date\n                if (\n                  value.toNumber() > new Date(2000, 1, 1).getTime() / 1000 &&\n                  value.toNumber() < new Date(2100, 1, 1).getTime() / 1000\n                ) {\n                  return [key, new Date(value.toNumber() * 1000)];\n                }\n\n                // Just a number\n                return [key, parseFloat(value.toString())];\n              }\n\n              // Not a number\n              return [key, value];\n            })\n        );\n\n        return {\n          data: errorData,\n          name: errorParsed.name,\n          signature: errorParsed.signature,\n          args: errorArgs,\n        };\n      } catch (e) {\n        console.error(e);\n        return undefined;\n      }\n    },\n    [Contract]\n  );\n}\n"],"names":["StepIcon","txnStatus","children","_jsx","CloseIcon","color","CheckIcon","Spinner","width","height","Box","__css","display","fontWeight","textAlign","fontSize","statusColor","BorrowModalUi","onClose","isOpen","debtChange","execBorrow","network","useNetwork","isBase","isBaseAndromeda","id","preset","_jsxs","Modal","size","closeOnOverlayClick","ModalOverlay","ModalContent","bg","ModalHeader","ModalCloseButton","ModalBody","Flex","gap","alignItems","rounded","p","border","transitionProperty","transitionDuration","borderColor","justifyContent","Text","Amount","value","suffix","Button","isDisabled","onClick","my","BorrowModal","useContext","ManagePositionContext","queryClient","useQueryClient","params","useParams","data","collateralType","useCollateralType","collateralSymbol","exec","txnState","settle","settleBorrow","useBorrow","accountId","poolId","collateralTypeAddress","dispatch","useReducer","reducer","initialState","CoreProxy","useCoreProxy","collateralPriceIds","useAllCollateralPriceIds","signer","useSigner","gasSpeed","useGasSpeed","provider","useProvider","mutation","useMutation","mutationFn","async","eq","type","populatedTxnPromised","populateTransaction","mintUsd","BigNumber","from","toBN","walletAddress","getAddress","collateralPriceCallsPromise","fetchPriceUpdates","isTestnet","then","signedData","priceUpdatesToPopulatedTx","calls","gasPrices","collateralPriceCalls","Promise","all","getGasPrice","allCalls","concat","erc7412Tx","withERC7412","interface","gasOptionsForTransaction","formatGasPriceForTransaction","gasLimit","txn","sendTransaction","payload","txnHash","hash","wait","error","isLoading","isPending","mutateAsync","tokenAddress","toast","useToast","isClosable","duration","errorParserCoreProxy","useContractErrorParser","execBorrowWithErrorParser","useCallback","invalidateQueries","queryKey","exact","contractError","console","Error","name","closeAll","title","description","ContractError","status","cause","defaultOpen","window","localStorage","CONTRACT_ERROR_OPEN","setIsOpen","React","_Fragment","variant","fontStyle","Collapse","in","animateOpacity","whiteSpace","pl","Object","entries","args","map","key","val","Date","format","join","createIcon","viewBox","path","fill","points","d","failed","success","loading","disabled","Step","minWidth","minHeight","StepCheckbox","props","mt","Checkbox","opacity","Multistep","step","subtitle","checkboxLabel","checkboxProps","position","direction","as","Contract","errorData","contractAbi","utils","full","errorParsed","ethers","address","Array","Set","ERC7412_ABI","parseError","errorArgs","fromEntries","filter","parseInt","unwei","parseFloat","toString","toNumber","getTime","signature","e"],"sourceRoot":""}