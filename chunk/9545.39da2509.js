"use strict";(globalThis.webpackChunk_snx_v3_liquidity=globalThis.webpackChunk_snx_v3_liquidity||[]).push([[9545],{49545:(e,t,a)=>{a.r(t),a.d(t,{UndelegateModal:()=>K,UndelegateModalUi:()=>F,default:()=>N});var l=a(75429),r=a(11082),o=a(59176),n=a(74008),s=a(84626),c=a(70065),i=a(45071),u=a(42219),d=a(99581),m=a(96596),h=a(77528),y=a(13797),C=a(25042),b=a(908),g=a(63322),x=a(8176),p=a(89536),f=a(70332),v=a(42736),S=a(79929),j=a(28145),k=a(97737),w=a(2784),T=a(1651),A=a(52465),E=a(21849),U=a(81826),q=a(9875),D=a(97386);const I="SET_AMOUNT",P="SET_COLLATERAL_SYMBOL",_="RETRY",G="RUN",L="RESET",M="idle",$="undelegate",H="failed",O="success",R={[$]:$},z="undelegate",Q={amount:(0,S.wei)(0),error:null,collateralSymbol:void 0},Y=(0,q.C)({id:"UndelegateMachine",initial:M,predictableActionArguments:!0,context:Q,on:{[L]:{target:M,actions:(0,D.f0)({amount:e=>Q.amount,error:e=>Q.error,collateralSymbol:e=>Q.collateralSymbol})},[I]:{actions:(0,D.f0)({amount:(e,t)=>t.amount})},[P]:{actions:(0,D.f0)({collateralSymbol:(e,t)=>t.symbol})}},states:{[M]:{on:{[G]:[{target:$,cond:e=>e.amount.gt(0)}]}},[$]:{invoke:{src:z,onError:{target:H,actions:(0,D.f0)({error:(e,t)=>({error:t.data,step:R.undelegate})})},onDone:[{target:O}]}},[H]:{on:{[_]:[{target:$,cond:e=>e.error?.step===R.undelegate,actions:(0,D.f0)({error:e=>null})}]}},[O]:{}}});var B=a(52322);const F=({txSummary:e,amount:t,isOpen:a,onClose:c,collateralType:u,onSubmit:d,state:m,error:h})=>{const y=m.matches($);if(a)return m.matches(O)?(0,B.jsx)(E.s,{onClose:d,title:"Collateral successfully Updated",subline:(0,B.jsxs)(B.Fragment,{children:["Your ",(0,B.jsx)("b",{children:"Collateral"})," has been updated, read more about it in the"," ",(0,B.jsx)(r.r,{href:"https://docs.synthetix.io/v/synthetix-v3-user-documentation",target:"_blank",color:"cyan.500",children:"Synthetix V3 Documentation"})]}),alertText:(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("b",{children:"Collateral"})," successfully Updated"]}),summary:e}):(0,B.jsxs)("div",{"data-cy":"undelegate multistep",children:[(0,B.jsxs)(o.x,{color:"gray.50",fontSize:"20px",fontWeight:700,children:[(0,B.jsx)(l.R,{cursor:"pointer",onClick:c,mr:2}),"Manage Collateral"]}),(0,B.jsx)(n.i,{my:4}),(0,B.jsx)(C.P0,{step:1,title:"Unlock collateral",subtitle:(0,B.jsxs)(o.x,{as:"div",children:[(0,B.jsx)(i.$,{value:t,suffix:` ${u?.displaySymbol}`})," will be unlocked from the pool."]}),status:{failed:Boolean(h?.step===$),disabled:t.eq(0),success:m.matches(O),loading:m.matches($)&&!h}}),(0,B.jsx)(s.z,{isDisabled:y,onClick:d,width:"100%",mt:"6","data-cy":"undelegate confirm button",children:(()=>{switch(!0){case Boolean(h):return"Retry";case y:return"Processing...";case m.matches(O):return"Continue";default:return"Execute Transaction"}})()})]})},K=({onClose:e,isOpen:t,liquidityPosition:a})=>{const l=(0,p.UO)(),{collateralChange:r,setCollateralChange:o}=(0,w.useContext)(y.n),{network:n}=(0,b.LN)(),s=(0,j.useQueryClient)(),{data:i}=(0,g.t)(l.collateralSymbol),C=(0,c.p)({isClosable:!0,duration:9e3}),[E,q]=(0,w.useState)({currentCollateral:u.GH,collateralChange:u.GH,currentDebt:u.GH}),D=a?.collateralAmount||(0,S.wei)(0),{exec:M}=(0,f.V)({accountId:l.accountId,poolId:l.poolId,collateralTypeAddress:a?.tokenAddress,collateralChange:r,currentCollateral:D}),{exec:$}=(0,v.G)({accountId:l.accountId,poolId:l.poolId,collateralTypeAddress:a?.tokenAddress,collateralChange:r,currentCollateral:D,liquidityPosition:a}),H=(0,x.o)(),R=(0,h.Yz)(n?.id,n?.preset),[Q,K]=(0,k.e)(Y,{context:{amount:r.abs()},services:{[z]:async()=>{try{q({currentCollateral:D,currentDebt:a?.debt||u.GH,collateralChange:r}),R?await $():await M(),s.invalidateQueries({queryKey:[`${n?.id}-${n?.preset}`,"LiquidityPosition"],exact:!1}),s.invalidateQueries({queryKey:[`${n?.id}-${n?.preset}`,"LiquidityPositions"]}),s.invalidateQueries({queryKey:[`${n?.id}-${n?.preset}`,"AccountCollateralUnlockDate",{accountId:l.accountId}]}),o(u.GH)}catch(e){const t=H(e);throw t&&console.error(new Error(t.name),t),C.closeAll(),C({title:"Unlock collateral failed",description:t?(0,B.jsx)(d.M,{contractError:t}):"Please try again.",status:"error",variant:"left-accent",duration:36e5}),Error("Unlock collateral failed",{cause:e})}}}}),N=r.toString();(0,w.useEffect)((()=>{K(I,{amount:(0,S.wei)(N).abs()})}),[N,K]),(0,w.useEffect)((()=>{K(P,{symbol:(0,S.wei)(N).abs()})}),[N,K]);const V=(0,w.useCallback)((async()=>{if(Q.matches(O))return K(L),void e();Q.context.error?K(_):K(G)}),[e,K,Q]),W=(0,w.useMemo)((()=>{const e=[{label:"Locked "+i?.displaySymbol,value:(0,B.jsx)(T.D,{value:E.currentCollateral,newValue:E.currentCollateral.add(E.collateralChange),formatFn:e=>(0,m.Aq)(e),hasChanges:E.collateralChange.abs().gt(0),size:"sm"})}];return R?e:[...e,{label:"C-ratio",value:(0,B.jsx)(A.p,{currentCollateral:E.currentCollateral,currentDebt:E.currentDebt,collateralChange:E.collateralChange,collateralPrice:a?.collateralPrice??u.GH,debtChange:u.GH,size:"sm"})}]}),[i?.displaySymbol,R,a?.collateralPrice,E.collateralChange,E.currentCollateral,E.currentDebt]);return(0,B.jsx)(F,{amount:Q.context.amount,isOpen:t,onClose:e,collateralType:i,state:Q,error:Q.context.error,onSubmit:V,txSummary:(0,B.jsx)(U.v,{items:W})})},N=K}}]);
//# sourceMappingURL=9545.39da2509.js.map