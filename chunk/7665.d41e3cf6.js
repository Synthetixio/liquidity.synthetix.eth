"use strict";(globalThis.webpackChunk_snx_v3_liquidity=globalThis.webpackChunk_snx_v3_liquidity||[]).push([[7665],{17665:(t,a,e)=>{e.r(a),e.d(a,{WithdrawModal:()=>Q,WithdrawModalUi:()=>M,default:()=>G});var s=e(75429),r=e(11082),o=e(59176),i=e(74008),n=e(84626),l=e(70065),c=e(45071),d=e(42219),u=e(99581),p=e(77528),w=e(13797),h=e(25042),y=e(1492),m=e(908),g=e(64996),b=e(85619),x=e(89536),f=e(73635),v=e(96596),C=e(17716),S=e(65666),T=e(40109),j=e(99),k=e(35834),A=e(95772),D=e(37888),W=e(28145),$=e(50986),N=e(10528),E=e(2784);const I=({accountId:t,collateralTypeAddress:a,amount:e})=>{const[s,r]=(0,E.useReducer)(C.I,C.E),{data:o}=(0,T.a)(),{data:i,refetch:n}=(0,S.Y_)(),{network:l}=(0,m.LN)(),{gasSpeed:c}=(0,A.jU)(),d=(0,m.mx)(),u=(0,m.yL)(),p=(0,W.useMutation)({mutationFn:async()=>{if(!d||!l||!u)throw new Error("No signer or network");if(!(o&&a&&e))throw new Error("Not ready");if(e?.eq(0))throw new Error("Amount less than 0");const s=await d.getAddress();try{r({type:"prompting"});const n=new $.CH(a,["function decimals() view returns (uint8)"],u),p=await n.decimals(),w=e.gt(0)?(0,v.vz)(e.toString(),p):N.O$.from(0),h=o.populateTransaction.withdraw(N.O$.from(t),a,w),y=Promise.all([h]),[m,g]=await Promise.all([y,(0,k.o)({provider:u})]);i&&m.unshift(i);const{multicallTxn:b,gasLimit:x}=await(0,D.dI)(l,m,"useWithdraw",s),f=(0,j.F)({gasLimit:x,gasPrices:g,gasSpeed:c}),C=await d.sendTransaction({...b,...f});r({type:"pending",payload:{txnHash:C.hash}}),await C.wait(),r({type:"success"})}catch(t){throw r({type:"error",payload:{error:t}}),t}},onSuccess:()=>{n()}});return{mutation:p,txnState:s,settle:()=>r({type:"settled"}),isLoading:p.isPending,exec:p.mutateAsync}};var L=e(37330),P=e(34367),q=e(7226),U=e(19175),B=e(51906),_=e(49494);const H=({accountId:t,availableCollateral:a,snxUSDCollateral:e,amountToWithdraw:s,accountCollateral:r,collateralSymbol:o})=>{const[i,n]=(0,E.useReducer)(C.I,C.E),{data:l}=(0,T.a)(),{data:c}=(0,q.b)(),{data:u}=(0,U.a)(),{data:w,refetch:h}=(0,S.Y_)(),{network:y}=(0,m.LN)(),{data:g}=(0,P.X)(),{gasSpeed:b}=(0,A.jU)(),x=(0,m.mx)(),f=(0,m.yL)(),v=(0,W.useMutation)({mutationFn:async()=>{if(!x||!y||!f)throw new Error("No signer or network");if(!(l&&c&&t&&g?.sUSD&&g.snxUSD))throw new Error("Not ready");if(e.add(a).lt(s))throw new Error("Exceeds balance");const i=s.gt(a)?a:s,h=s.sub(i).gt(0)?s.sub(i):d.GH;try{const e=(0,p.$l)(o);n({type:"prompting"});const s=(0,k.o)({provider:f}),m=i.gt(0)?l.populateTransaction.withdraw(N.O$.from(t),r?.tokenAddress,i.toBN()):void 0,v=h.gt(0)?l.populateTransaction.withdraw(N.O$.from(t),g?.snxUSD,h.toBN()):void 0,C=h.gt(0)?u?.populateTransaction.approve(c.address,h.toBN()):void 0,S=h.gt(0)?c.populateTransaction.buy(e,h.toBN(),0,B.d):void 0,T=h.gt(0)?(await c.callStatic.quoteBuyExactIn(e,h.toBN(),0)).synthAmount:d.GH,A=a.add(T),W=c.populateTransaction.unwrap(e,A.toBN(),Number(_.formatUnits(A.toBN().mul(98).div(100).toString(),12).toString()).toFixed()),[$,E,I,P,q,U]=await Promise.all([s,m,v,C,S,W]),H=[E,I,P,q,U].filter(L._);w&&H.unshift(w);const O=await x.getAddress(),{multicallTxn:F,gasLimit:M}=await(0,D.dI)(y,H,"useWithdrawBase",O),Q=(0,j.F)({gasLimit:M,gasPrices:$,gasSpeed:b}),G=await x.sendTransaction({...F,...Q});n({type:"pending",payload:{txnHash:G.hash}}),await G.wait(),n({type:"success"})}catch(t){throw n({type:"error",payload:{error:t}}),t}},onSuccess:()=>{h()}});return{mutation:v,txnState:i,settle:()=>n({type:"settled"}),isLoading:v.isPending,exec:v.mutateAsync}};var O=e(21849),F=e(52322);const M=({isDebtWithdrawal:t,amount:a,isOpen:e,onClose:l,onSubmit:d,state:u,symbol:p})=>{if(e)return u.step>1?(0,F.jsx)(O.s,{onClose:d,title:(t?"Debt":"Collateral")+" successfully Withdrawn",subline:(0,F.jsxs)(F.Fragment,{children:["Your ",(0,F.jsx)("b",{children:t?"Debt":"Collateral"})," has been withdrawn, read more about it in the"," ",(0,F.jsx)(r.r,{href:"https://docs.synthetix.io/v/synthetix-v3-user-documentation",target:"_blank",color:"cyan.500",children:"Synthetix V3 Documentation"})]}),alertText:(t?"Debt":"Collateral")+" successfully Withdrawn"}):(0,F.jsxs)("div",{"data-cy":"withdraw multistep",children:[(0,F.jsxs)(o.x,{color:"gray.50",fontSize:"20px",fontWeight:700,children:[(0,F.jsx)(s.R,{cursor:"pointer",onClick:l,mr:2}),"Manage ",t?"Debt":"Collateral"]}),(0,F.jsx)(i.i,{my:4}),(0,F.jsx)(h.P0,{step:1,title:"Withdraw",subtitle:(0,F.jsxs)(o.x,{as:"div",children:[(0,F.jsx)(c.$,{value:a}),"Â ",p," will be withdrawn"]}),status:{failed:1===u.step&&"error"===u.status,success:u.step>1,loading:1===u.step&&"pending"===u.status}}),(0,F.jsx)(n.z,{isDisabled:"pending"===u.status,onClick:d,width:"100%",mt:"6","data-cy":"withdraw confirm button",children:(()=>{switch(!0){case"error"===u.status:return"Retry";case"pending"===u.status:return"Processing...";case u.step>1:return"Done";default:return"Execute Transaction"}})()})]})};function Q({liquidityPosition:t,onClose:a,isOpen:e,isDebtWithdrawal:s=!1}){const[r,o]=(0,E.useState)({step:1,status:"idle"}),i=(0,x.UO)(),n=(0,l.p)({isClosable:!0,duration:9e3}),{network:c}=(0,m.LN)(),h=(0,W.useQueryClient)(),{withdrawAmount:v,setWithdrawAmount:C}=(0,E.useContext)(w.n),{data:S}=(0,g.t)(i.collateralSymbol),T=(0,b.o)(),j=t?.accountId,{data:k}=(0,f.p)(),{data:A}=(0,y.jZ)(j,k?.address),{mutation:D}=I({amount:v,accountId:j,collateralTypeAddress:s?k?.address:t?.accountCollateral?.tokenAddress}),{mutation:$}=H({accountId:j,availableCollateral:t?.accountCollateral.availableCollateral||d.GH,snxUSDCollateral:A?.availableCollateral||d.GH,amountToWithdraw:v,accountCollateral:t?.accountCollateral,collateralSymbol:i.collateralSymbol}),N=(0,E.useCallback)((async()=>{try{1===r.step?(o({step:1,status:"pending"}),(0,p.Yz)(c?.id,c?.preset)?await $.mutateAsync():await D.mutateAsync(),o({step:2,status:"success"}),h.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"LiquidityPosition",{accountId:j}]}),h.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"AccountSpecificCollateral",{accountId:j}]}),h.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"LiquidityPositions",{accountId:j}]}),h.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"AccountCollateralUnlockDate",{accountId:j}]}),h.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"TokenBalance"]}),C(d.GH)):a()}catch(t){o((t=>({...t,status:"error"})));const a=T(t);throw a&&console.error(new Error(a.name),a),n.closeAll(),n({title:"Withdraw failed",description:a?(0,F.jsx)(u.M,{contractError:a}):"Please try again.",status:"error",variant:"left-accent"}),Error("Withdraw failed",{cause:t})}}),[j,T,c?.id,c?.preset,a,h,C,n,r.step,$,D]);return(0,F.jsx)(M,{amount:v,isOpen:e,onClose:a,symbol:s?k?.symbol:S?.symbol,state:r,onSubmit:N,isDebtWithdrawal:s})}const G=Q}}]);
//# sourceMappingURL=7665.d41e3cf6.js.map