"use strict";(globalThis.webpackChunk_snx_v3_staking_ui=globalThis.webpackChunk_snx_v3_staking_ui||[]).push([[3967],{3967:(e,t,r)=>{r.r(t),r.d(t,{BorrowModal:()=>M,BorrowModalUi:()=>E,default:()=>q});var s=r(81540),n=r(28535),o=r(66901),a=r(26468),i=r(19433),c=r(54326),l=r(2338),d=r(97217),u=r(38035),h=r(59176),x=r(84626),p=r(88115),g=r(45071),w=r(74774),y=r(2784),m=r(89536),b=r(13797),j=r(19299),C=r(40109),f=r(79634),k=r(61038),S=r(17716),I=r(10528),_=r(99),L=r(35834),O=r(95772),v=r(86848),B=r(42614),T=r(95522);var A=r(97721),P=r(46160),D=r(52322);function U({txnStatus:e,children:t}){switch(e){case"error":return(0,D.jsx)(w.Tw,{color:"white"});case"success":return(0,D.jsx)(w.nQ,{color:"white"});case"prompting":case"pending":return(0,D.jsx)(s.$,{color:"white",width:6,height:6});default:return(0,D.jsx)(n.xu,{__css:{display:"inline",fontWeight:"medium",textAlign:"center",fontSize:"md"},children:t})}}const $=e=>"error"===e||"success"===e?e:"gray.700",E=({onClose:e,isOpen:t,debtChange:r,txnStatus:s,execBorrow:n})=>(0,D.jsxs)(o.u_,{size:"lg",isOpen:t,onClose:e,closeOnOverlayClick:!1,children:[(0,D.jsx)(a.Z,{width:"100%",height:"100%"}),(0,D.jsxs)(i.h,{bg:"black",color:"white","data-testid":"borrow modal",children:[(0,D.jsx)(c.x,{children:"Complete this action"}),(0,D.jsx)(l.o,{}),(0,D.jsxs)(d.f,{children:[(0,D.jsxs)(u.k,{gap:2,alignItems:"center",rounded:"lg",p:"4",border:"2px solid",transitionProperty:"border-color",transitionDuration:"normal",borderColor:$(s),children:[(0,D.jsx)(u.k,{width:10,height:10,justifyContent:"center",alignItems:"center",bg:$(s),rounded:"full",transitionProperty:"background",transitionDuration:"normal",children:(0,D.jsx)(U,{txnStatus:s,children:"1"})}),(0,D.jsxs)(h.x,{children:["Borrow ",(0,D.jsx)(g.$,{value:r,suffix:" snxUSD"})]})]}),(0,D.jsx)(x.z,{isDisabled:"pending"===s,onClick:()=>{"unsent"===s&&n(),"success"===s&&e()},width:"100%",my:"4","data-testid":"borrow confirm button",children:(()=>{switch(s){case"error":return"Retry";case"pending":return"Processing...";case"success":return"Done";default:return"Start"}})()})]})]})]}),M=({onClose:e,isOpen:t})=>{const{debtChange:r}=(0,y.useContext)(b.n),s=(0,f.useQueryClient)(),n=(0,m.UO)(),{data:o}=(0,j.t)(n.collateralSymbol),{exec:a,txnState:i,settle:c}=(({accountId:e,poolId:t,collateralTypeAddress:r,debtChange:s})=>{const[n,o]=(0,y.useReducer)(S.I,S.E),{data:a}=(0,C.a)(),{data:i}=(0,B.L)(),c=(0,k.mx)(),{gasSpeed:l}=(0,O.jU)(),d=(0,k.yL)(),u=(0,k.LN)(),h=(0,f.useMutation)({mutationFn:async()=>{if(c&&a&&t&&e&&r&&i&&!s.eq(0))try{o({type:"prompting"});const n=a.populateTransaction.mintUsd(I.O$.from(e),I.O$.from(t),r,s.toBN()),h=await c.getAddress(),x=(0,T.$)(i,u.isTestnet).then((e=>(0,T.x)(h,i,e))),[p,g,w]=await Promise.all([n,(0,L.o)({provider:d}),x]),y=w.concat(p),m=await(0,v.dI)(d,y,"borrow"),b=(0,_.F)({gasLimit:m.gasLimit,gasPrices:g,gasSpeed:l}),j=await c.sendTransaction({...m,...b});o({type:"pending",payload:{txnHash:j.hash}}),await j.wait(),o({type:"success"})}catch(e){throw o({type:"error",payload:{error:e}}),e}}});return{mutation:h,txnState:n,settle:()=>o({type:"settled"}),isLoading:h.isLoading,exec:h.mutateAsync}})({accountId:n.accountId,poolId:n.poolId,collateralTypeAddress:o?.tokenAddress,debtChange:r}),l=(0,p.p)({isClosable:!0,duration:9e3}),{data:d}=(0,C.a)(),u=(0,k.LN)(),h=(0,A.o)(d),x=(0,y.useCallback)((async()=>{try{await a(),await s.invalidateQueries({queryKey:[u.name,"LiquidityPosition"],exact:!1})}catch(e){const t=h(e);throw t&&console.error(new Error(t.name),t),l.closeAll(),l({title:"Borrow failed",description:t?(0,D.jsx)(P.M,{contractError:t}):"Please try again.",status:"error"}),Error("Borrow failed",{cause:e})}}),[h,a,s,l,u.name]),{txnStatus:g}=i;return n.poolId&&n.accountId&&o?(0,D.jsx)(E,{execBorrow:x,debtChange:r,txnStatus:g,onClose:()=>{c(),e()},isOpen:t}):null},q=M}}]);
//# sourceMappingURL=3967.adce0d97.js.map