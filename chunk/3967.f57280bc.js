"use strict";(globalThis.webpackChunk_snx_v3_liquidity=globalThis.webpackChunk_snx_v3_liquidity||[]).push([[3967],{3967:(e,t,r)=>{r.r(t),r.d(t,{BorrowModal:()=>E,BorrowModalUi:()=>U,default:()=>M});var s=r(81540),n=r(28535),o=r(66901),a=r(26468),i=r(19433),c=r(54326),l=r(2338),d=r(97217),u=r(38035),h=r(59176),p=r(84626),x=r(70065),g=r(45071),w=r(25042),y=r(2784),m=r(89536),b=r(13797),j=r(19299),C=r(40109),f=r(28145),S=r(76885),k=r(17716),I=r(10528),O=r(99),_=r(35834),v=r(95772),B=r(86848),L=r(51686),P=r(95522);var T=r(97721),A=r(99581),$=r(52322);function q({txnStatus:e,children:t}){switch(e){case"error":return(0,$.jsx)(w.Tw,{color:"white"});case"success":return(0,$.jsx)(w.nQ,{color:"white"});case"prompting":case"pending":return(0,$.jsx)(s.$,{color:"white",width:6,height:6});default:return(0,$.jsx)(n.xu,{__css:{display:"inline",fontWeight:"medium",textAlign:"center",fontSize:"md"},children:t})}}const D=e=>"error"===e||"success"===e?e:"gray.700",U=({onClose:e,isOpen:t,debtChange:r,txnStatus:s,execBorrow:n})=>(0,$.jsxs)(o.u_,{size:"lg",isOpen:t,onClose:e,closeOnOverlayClick:!1,children:[(0,$.jsx)(a.Z,{width:"100%",height:"100%"}),(0,$.jsxs)(i.h,{bg:"black",color:"white","data-testid":"borrow modal",children:[(0,$.jsx)(c.x,{children:"Complete this action"}),(0,$.jsx)(l.o,{}),(0,$.jsxs)(d.f,{children:[(0,$.jsxs)(u.k,{gap:2,alignItems:"center",rounded:"lg",p:"4",border:"2px solid",transitionProperty:"border-color",transitionDuration:"normal",borderColor:D(s),children:[(0,$.jsx)(u.k,{width:10,height:10,justifyContent:"center",alignItems:"center",bg:D(s),rounded:"full",transitionProperty:"background",transitionDuration:"normal",children:(0,$.jsx)(q,{txnStatus:s,children:"1"})}),(0,$.jsxs)(h.x,{children:["Borrow ",(0,$.jsx)(g.$,{value:r,suffix:" snxUSD"})]})]}),(0,$.jsx)(p.z,{isDisabled:"pending"===s,onClick:()=>{"unsent"===s&&n(),"success"===s&&e()},width:"100%",my:"4","data-testid":"borrow confirm button",children:(()=>{switch(s){case"error":return"Retry";case"pending":return"Processing...";case"success":return"Done";default:return"Start"}})()})]})]})]}),E=({onClose:e,isOpen:t})=>{const{debtChange:r}=(0,y.useContext)(b.n),s=(0,f.useQueryClient)(),n=(0,m.UO)(),{data:o}=(0,j.t)(n.collateralSymbol),{exec:a,txnState:i,settle:c}=(({accountId:e,poolId:t,collateralTypeAddress:r,debtChange:s})=>{const[n,o]=(0,y.useReducer)(k.I,k.E),{data:a}=(0,C.a)(),{data:i}=(0,L.L)(),c=(0,S.mx)(),{gasSpeed:l}=(0,v.jU)(),d=(0,S.yL)(),u=(0,S.LN)(),h=(0,f.useMutation)({mutationFn:async()=>{if(c&&a&&t&&e&&r&&i&&!s.eq(0))try{o({type:"prompting"});const n=a.populateTransaction.mintUsd(I.O$.from(e),I.O$.from(t),r,s.toBN()),h=await c.getAddress(),p=(0,P.$)(i,u.isTestnet).then((e=>(0,P.x)(h,i,e))),[x,g,w]=await Promise.all([n,(0,_.o)({provider:d}),p]),y=w.concat(x),m=await(0,B.dI)(u,y,"borrow"),b=(0,O.F)({gasLimit:m.gasLimit,gasPrices:g,gasSpeed:l}),j=await c.sendTransaction({...m,...b});o({type:"pending",payload:{txnHash:j.hash}}),await j.wait(),o({type:"success"})}catch(e){throw o({type:"error",payload:{error:e}}),e}}});return{mutation:h,txnState:n,settle:()=>o({type:"settled"}),isLoading:h.isPending,exec:h.mutateAsync}})({accountId:n.accountId,poolId:n.poolId,collateralTypeAddress:o?.tokenAddress,debtChange:r}),l=(0,x.p)({isClosable:!0,duration:9e3}),{data:d}=(0,C.a)(),u=(0,S.LN)(),h=(0,T.o)(d),p=(0,y.useCallback)((async()=>{try{await a(),await s.invalidateQueries({queryKey:[`${u.id}-${u.preset}`,"LiquidityPosition"],exact:!1})}catch(e){const t=h(e);throw t&&console.error(new Error(t.name),t),l.closeAll(),l({title:"Borrow failed",description:t?(0,$.jsx)(A.M,{contractError:t}):"Please try again.",status:"error"}),Error("Borrow failed",{cause:e})}}),[a,s,u.id,u.preset,h,l]),{txnStatus:g}=i;return n.poolId&&n.accountId&&o?(0,$.jsx)(U,{execBorrow:p,debtChange:r,txnStatus:g,onClose:()=>{c(),e()},isOpen:t}):null},M=E}}]);
//# sourceMappingURL=3967.f57280bc.js.map