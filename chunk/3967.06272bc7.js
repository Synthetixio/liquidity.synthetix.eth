"use strict";(globalThis.webpackChunk_snx_v3_liquidity=globalThis.webpackChunk_snx_v3_liquidity||[]).push([[3967],{3967:(e,t,r)=>{r.r(t),r.d(t,{BorrowModal:()=>E,BorrowModalUi:()=>z,default:()=>M});var s=r(81540),n=r(28535),o=r(66901),a=r(26468),i=r(19433),c=r(54326),l=r(2338),d=r(97217),u=r(38035),h=r(59176),p=r(84626),x=r(70065),g=r(45071),w=r(25042),y=r(2784),m=r(89536),b=r(13797),C=r(19299),j=r(40109),f=r(97721),k=r(99581),S=r(28145),I=r(76885),L=r(17716),O=r(10528),_=r(99),v=r(35834),B=r(95772),P=r(860),T=r(51686),A=r(95522);var $=r(77528),D=r(52322);function U({txnStatus:e,children:t}){switch(e){case"error":return(0,D.jsx)(w.Tw,{color:"white"});case"success":return(0,D.jsx)(w.nQ,{color:"white"});case"prompting":case"pending":return(0,D.jsx)(s.$,{color:"white",width:6,height:6});default:return(0,D.jsx)(n.xu,{__css:{display:"inline",fontWeight:"medium",textAlign:"center",fontSize:"md"},children:t})}}const q=e=>"error"===e||"success"===e?e:"gray.700",z=({onClose:e,isOpen:t,debtChange:r,txnStatus:s,execBorrow:n})=>{const{network:x}=(0,I.LN)(),w=(0,$.Yz)(x?.id,x?.preset);return(0,D.jsxs)(o.u_,{size:"lg",isOpen:t,onClose:e,closeOnOverlayClick:!1,children:[(0,D.jsx)(a.Z,{width:"100%",height:"100%"}),(0,D.jsxs)(i.h,{bg:"black",color:"white","data-testid":"borrow modal",children:[(0,D.jsx)(c.x,{children:"Complete this action"}),(0,D.jsx)(l.o,{}),(0,D.jsxs)(d.f,{children:[(0,D.jsxs)(u.k,{gap:2,alignItems:"center",rounded:"lg",p:"4",border:"2px solid",transitionProperty:"border-color",transitionDuration:"normal",borderColor:q(s),children:[(0,D.jsx)(u.k,{width:10,height:10,justifyContent:"center",alignItems:"center",bg:q(s),rounded:"full",transitionProperty:"background",transitionDuration:"normal",children:(0,D.jsx)(U,{txnStatus:s,children:"1"})}),(0,D.jsxs)(h.x,{children:[w?"Claim":"Borrow"," ",(0,D.jsx)(g.$,{value:r,suffix:w?" USDC":" snxUSD"})]})]}),(0,D.jsx)(p.z,{isDisabled:"pending"===s,onClick:()=>{"unsent"===s&&n(),"success"===s&&e()},width:"100%",my:"4","data-testid":"borrow confirm button",children:(()=>{switch(s){case"error":return"Retry";case"pending":return"Processing...";case"success":return"Done";default:return"Start"}})()})]})]})]})},E=({onClose:e,isOpen:t})=>{const{debtChange:r}=(0,y.useContext)(b.n),s=(0,S.useQueryClient)(),n=(0,m.UO)(),{data:o}=(0,C.t)(n.collateralSymbol),{exec:a,txnState:i,settle:c}=(({accountId:e,poolId:t,collateralTypeAddress:r,debtChange:s})=>{const[n,o]=(0,y.useReducer)(L.I,L.E),{data:a}=(0,j.a)(),{data:i}=(0,T.L)(),c=(0,I.mx)(),{gasSpeed:l}=(0,B.jU)(),d=(0,I.yL)(),{network:u}=(0,I.LN)(),h=(0,S.useMutation)({mutationFn:async()=>{if(c&&a&&t&&e&&r&&i&&u&&d&&!s.eq(0))try{o({type:"prompting"});const n=a.populateTransaction.mintUsd(O.O$.from(e),O.O$.from(t),r,s.toBN()),h=await c.getAddress(),p=(0,A.$)(i,u.isTestnet).then((e=>(0,A.x)(h,i,e))),[x,g,w]=await Promise.all([n,(0,v.o)({provider:d}),p]),y=w.concat(x),m=await(0,P.dI)(u,y,"borrow",a.interface),b=(0,_.F)({gasLimit:m.gasLimit,gasPrices:g,gasSpeed:l}),C=await c.sendTransaction({...m,...b});o({type:"pending",payload:{txnHash:C.hash}}),await C.wait(),o({type:"success"})}catch(e){throw o({type:"error",payload:{error:e}}),e}}});return{mutation:h,txnState:n,settle:()=>o({type:"settled"}),isLoading:h.isPending,exec:h.mutateAsync}})({accountId:n.accountId,poolId:n.poolId,collateralTypeAddress:o?.tokenAddress,debtChange:r}),l=(0,x.p)({isClosable:!0,duration:9e3}),{data:d}=(0,j.a)(),{network:u}=(0,I.LN)(),h=(0,f.o)(d),p=(0,y.useCallback)((async()=>{try{await a(),await s.invalidateQueries({queryKey:[`${u?.id}-${u?.preset}`,"LiquidityPosition"],exact:!1})}catch(e){const t=h(e);throw t&&console.error(new Error(t.name),t),l.closeAll(),l({title:"Borrow failed",description:t?(0,D.jsx)(k.M,{contractError:t}):"Please try again.",status:"error"}),Error("Borrow failed",{cause:e})}}),[a,s,u?.id,u?.preset,h,l]),{txnStatus:g}=i;return n.poolId&&n.accountId&&o?(0,D.jsx)(z,{execBorrow:p,debtChange:r,txnStatus:g,onClose:()=>{c(),e()},isOpen:t}):null},M=E}}]);
//# sourceMappingURL=3967.06272bc7.js.map