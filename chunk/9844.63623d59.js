"use strict";(globalThis.webpackChunk_snx_v3_staking_ui=globalThis.webpackChunk_snx_v3_staking_ui||[]).push([[9844],{49844:(a,t,e)=>{e.r(t),e.d(t,{WithdrawModal:()=>$,WithdrawModalUi:()=>I,default:()=>D});var r=e(66901),s=e(26468),o=e(19433),n=e(54326),l=e(2338),i=e(97217),c=e(59176),d=e(84626),u=e(88115),w=e(2784),h=e(45071),p=e(47973),m=e(74774),E=e(89536),y=e(79929),b=e(9875),g=e(97386);const T={SET_AMOUNT:"SET_AMOUNT",SET_COLLATERAL_SYMBOL:"SET_COLLATERAL_SYMBOL",RETRY:"RETRY",RUN:"RUN",SUCCESS:"SUCCESS",FAILURE:"FAILURE",RESET:"RESET"},x={idle:"idle",withdraw:"withdraw",unwrap:"unwrap",failed:"failed",success:"success"},f={[x.withdraw]:x.withdraw,[x.unwrap]:x.unwrap},S={withdraw:"withdraw",unwrap:"unwrap"},C={amount:(0,y.wei)(0),error:null,collateralSymbol:void 0},R=(0,b.C)({id:"WithdrawMachine",initial:x.idle,predictableActionArguments:!0,context:C,on:{[T.RESET]:{target:x.idle,actions:(0,g.f0)({amount:a=>C.amount,error:a=>C.error,collateralSymbol:a=>C.collateralSymbol})},[T.SET_AMOUNT]:{actions:(0,g.f0)({amount:(a,t)=>t.amount})},[T.SET_COLLATERAL_SYMBOL]:{actions:(0,g.f0)({collateralSymbol:(a,t)=>t.symbol})}},states:{[x.idle]:{on:{[T.RUN]:[{target:x.withdraw,cond:a=>a.amount.gt(0)},{target:x.unwrap,cond:a=>a.amount.gt(0)&&"WETH"===a.collateralSymbol}]}},[x.withdraw]:{invoke:{src:S.withdraw,onError:{target:x.failed,actions:(0,g.f0)({error:(a,t)=>({error:t.data,step:f.withdraw})})},onDone:[{target:x.unwrap,cond:a=>"WETH"===a.collateralSymbol},{target:x.success}]}},[x.unwrap]:{invoke:{src:S.unwrap,onDone:{target:x.success},onError:{target:x.failed,actions:(0,g.f0)({error:(a,t)=>({error:t.data,step:f.unwrap})})}}},[x.failed]:{on:{[T.RETRY]:[{target:x.withdraw,cond:a=>a.error?.step===f.withdraw,actions:(0,g.f0)({error:a=>null})},{target:x.unwrap,cond:a=>a.error?.step===f.unwrap,actions:(0,g.f0)({error:a=>null})}]}},[x.success]:{}}});var v=e(97737),A=e(40109),L=e(79634),U=e(61038),O=e(17716),_=e(10528),j=e(1492),k=e(99),W=e(35834),M=e(95772);const N=({accountId:a,collateralTypeAddress:t})=>{const{data:e}=(0,j.jZ)(a,t),[r,s]=(0,w.useReducer)(O.I,O.E),{data:o}=(0,A.a)(),{gasSpeed:n}=(0,M.jU)(),l=(0,U.mx)(),i=(0,U.yL)(),c=(0,L.useMutation)({mutationFn:async()=>{if(l&&o&&t&&e?.availableCollateral&&!e?.availableCollateral.eq(0))try{s({type:"prompting"});const r=(0,W.o)({provider:i}),c=o.estimateGas.withdraw(_.O$.from(a),t,e?.availableCollateral.toBN()),d=o.populateTransaction.withdraw(_.O$.from(a),t,e?.availableCollateral.toBN(),{gasLimit:c}),[u,w,h]=await Promise.all([r,c,d]),p=(0,k.F)({gasLimit:w,gasPrices:u,gasSpeed:n}),m=await l.sendTransaction({...h,...p});s({type:"pending",payload:{txnHash:m.hash}}),await m.wait(),s({type:"success"})}catch(a){throw s({type:"error",payload:{error:a}}),a}}});return{mutation:c,txnState:r,settle:()=>s({type:"settled"}),isLoading:c.isLoading,exec:c.mutateAsync}};var H=e(97721),B=e(46160),P=e(50899),Y=e(52322);const I=({amount:a,isOpen:t,onClose:e,accountCollateral:u,onSubmit:w,state:p,error:E})=>{const y=p.matches(x.withdraw)||p.matches(x.unwrap);return(0,Y.jsxs)(r.u_,{size:"lg",isOpen:t,onClose:e,closeOnOverlayClick:!1,children:[(0,Y.jsx)(s.Z,{}),(0,Y.jsxs)(o.h,{bg:"black",color:"white","data-testid":"withdraw modal",children:[(0,Y.jsx)(P.$,{}),(0,Y.jsx)(n.x,{children:"Complete this action"}),(0,Y.jsx)(l.o,{}),(0,Y.jsxs)(i.f,{children:[(0,Y.jsx)(c.x,{mb:"2",children:"Please execute the following transactions:"}),(0,Y.jsx)(m.P0,{step:1,title:"Withdraw",subtitle:(0,Y.jsxs)(c.x,{as:"div",children:[(0,Y.jsx)(h.$,{value:a,suffix:` ${u?.symbol}`})," will be withdrawn"]}),status:{failed:Boolean(E?.step===x.withdraw),disabled:a.eq(0),success:p.matches(x.unwrap)||p.matches(x.success),loading:p.matches(x.withdraw)&&!E}}),"WETH"===u?.symbol?(0,Y.jsx)(m.P0,{step:2,title:`Unwrap ${u?.symbol}`,subtitle:"This will unwrap your WETH to ETH",status:{failed:Boolean(E?.step===x.unwrap),disabled:"WETH"!==u?.symbol,success:p.matches(x.success),loading:p.matches(x.unwrap)}}):null,(0,Y.jsx)(d.z,{isDisabled:y,onClick:w,width:"100%",my:"4","data-testid":"withdraw confirm button",children:(()=>{switch(!0){case Boolean(E):return"Retry";case y:return"Processing...";case p.matches(x.success):return"Done";default:return"Start"}})()})]})]})]})};function $({accountCollateral:a,onClose:t,isOpen:e}){const r=(0,E.UO)(),s=(0,u.p)({isClosable:!0,duration:9e3}),o=(0,U.LN)(),{exec:n}=(0,p.E)(),{exec:l}=N({accountId:r.accountId,collateralTypeAddress:a?.tokenAddress}),i=(0,L.useQueryClient)(),{data:c}=(0,A.a)(),d=(0,H.o)(c),[h,m]=(0,v.e)(R,{context:{amount:a?.availableCollateral},services:{[S.withdraw]:async()=>{try{await l(),await i.invalidateQueries({queryKey:[o.name,"AccountSpecificCollateral"]})}catch(a){const t=d(a);throw t&&console.error(new Error(t.name),t),s.closeAll(),s({title:"Withdraw failed",description:t?(0,Y.jsx)(B.M,{contractError:t}):"Please try again.",status:"error"}),Error("Withdraw failed",{cause:a})}},[S.unwrap]:async()=>{try{s({title:"Unwrap",description:"Unwrapping WETH to ETH.",status:"info"}),await n(h.context.amount)}catch(a){throw s.closeAll(),s({title:"Unwrap failed",description:"Please try again.",status:"error"}),Error("Unwrap failed",{cause:a})}}}}),y=(0,w.useCallback)((async()=>{if(h.matches(x.success))return m(T.RESET),void t();h.context.error?m(T.RETRY):m(T.RUN)}),[t,m,h]);return(0,Y.jsx)(I,{amount:h.context.amount,isOpen:e,onClose:t,accountCollateral:a,state:h,error:h.context.error,onSubmit:y})}const D=$}}]);
//# sourceMappingURL=9844.63623d59.js.map