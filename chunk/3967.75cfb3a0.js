"use strict";(globalThis.webpackChunk_snx_v3_liquidity=globalThis.webpackChunk_snx_v3_liquidity||[]).push([[3967],{3967:(e,t,r)=>{r.r(t),r.d(t,{BorrowModal:()=>M,BorrowModalUi:()=>B,default:()=>R});var n=r(81540),i=r(28535),o=r(66901),s=r(26468),a=r(19433),c=r(54326),l=r(2338),d=r(97217),u=r(38035),h=r(59176),x=r(84626),p=r(70065),g=r(45071),m=r(25042),f=r(2784),w=r(89536),y=r(13797),j=r(64996),b=r(40109),C=r(97721),S=r(99581),k=r(28145),v=r(76885),I=r(17716),O=r(10528),T=r(99),L=r(35834),A=r(95772),D=r(60341),P=r(78289),$=r(95522);var _=r(77528),z=r(52322);function E({txnStatus:e,children:t}){switch(e){case"error":return(0,z.jsx)(m.Tw,{color:"white"});case"success":return(0,z.jsx)(m.nQ,{color:"white"});case"prompting":case"pending":return(0,z.jsx)(n.$,{color:"white",width:6,height:6});default:return(0,z.jsx)(i.xu,{__css:{display:"inline",fontWeight:"medium",textAlign:"center",fontSize:"md"},children:t})}}const N=e=>"error"===e||"success"===e?e:"gray.700",B=({onClose:e,isOpen:t,debtChange:r,txnStatus:n,execBorrow:i})=>{const{network:p}=(0,v.LN)(),m=(0,_.Yz)(p?.id,p?.preset);return(0,z.jsxs)(o.u_,{size:"lg",isOpen:t,onClose:e,closeOnOverlayClick:!1,children:[(0,z.jsx)(s.Z,{width:"100%",height:"100%"}),(0,z.jsxs)(a.h,{bg:"black",color:"white","data-testid":"borrow modal",children:[(0,z.jsx)(c.x,{children:"Complete this action"}),(0,z.jsx)(l.o,{}),(0,z.jsxs)(d.f,{children:[(0,z.jsxs)(u.k,{gap:2,alignItems:"center",rounded:"lg",p:"4",border:"2px solid",transitionProperty:"border-color",transitionDuration:"normal",borderColor:N(n),children:[(0,z.jsx)(u.k,{width:10,height:10,justifyContent:"center",alignItems:"center",bg:N(n),rounded:"full",transitionProperty:"background",transitionDuration:"normal",children:(0,z.jsx)(E,{txnStatus:n,children:"1"})}),(0,z.jsxs)(h.x,{children:[m?"Claim":"Borrow"," ",(0,z.jsx)(g.$,{value:r,suffix:m?" USDC":" snxUSD"})]})]}),(0,z.jsx)(x.z,{isDisabled:"pending"===n,onClick:()=>{"unsent"===n&&i(),"success"===n&&e()},width:"100%",my:"4","data-testid":"borrow confirm button",children:(()=>{switch(n){case"error":return"Retry";case"pending":return"Processing...";case"success":return"Done";default:return"Start"}})()})]})]})]})},M=({onClose:e,isOpen:t})=>{const{debtChange:r}=(0,f.useContext)(y.n),n=(0,k.useQueryClient)(),i=(0,w.UO)(),{data:o}=(0,j.t)(i.collateralSymbol),{exec:s,txnState:a,settle:c}=(({accountId:e,poolId:t,collateralTypeAddress:r,debtChange:n})=>{const[i,o]=(0,f.useReducer)(I.I,I.E),{data:s}=(0,b.a)(),{data:a}=(0,P.L)(),c=(0,v.mx)(),{gasSpeed:l}=(0,A.jU)(),d=(0,v.yL)(),{network:u}=(0,v.LN)(),h=(0,k.useMutation)({mutationFn:async()=>{if(c&&s&&t&&e&&r&&a&&u&&d&&!n.eq(0))try{o({type:"prompting"});const i=s.populateTransaction.mintUsd(O.O$.from(e),O.O$.from(t),r,n.toBN()),h=await c.getAddress(),x=(0,$.$)(a,u.isTestnet).then((e=>(0,$.x)(h,a,e))),[p,g,m]=await Promise.all([i,(0,L.o)({provider:d}),x]),f=m.concat(p),w=await(0,D.dI)(u,f,"borrow"),y=(0,T.F)({gasLimit:w.gasLimit,gasPrices:g,gasSpeed:l}),j=await c.sendTransaction({...w,...y});o({type:"pending",payload:{txnHash:j.hash}}),await j.wait(),o({type:"success"})}catch(e){throw o({type:"error",payload:{error:e}}),e}}});return{mutation:h,txnState:i,settle:()=>o({type:"settled"}),isLoading:h.isPending,exec:h.mutateAsync}})({accountId:i.accountId,poolId:i.poolId,collateralTypeAddress:o?.tokenAddress,debtChange:r}),l=(0,p.p)({isClosable:!0,duration:9e3}),{data:d}=(0,b.a)(),{network:u}=(0,v.LN)(),h=(0,C.o)(d),x=(0,f.useCallback)((async()=>{try{await s(),await n.invalidateQueries({queryKey:[`${u?.id}-${u?.preset}`,"LiquidityPosition"],exact:!1})}catch(e){const t=h(e);throw t&&console.error(new Error(t.name),t),l.closeAll(),l({title:"Borrow failed",description:t?(0,z.jsx)(S.M,{contractError:t}):"Please try again.",status:"error"}),Error("Borrow failed",{cause:e})}}),[s,n,u?.id,u?.preset,h,l]),{txnStatus:g}=a;return i.poolId&&i.accountId&&o?(0,z.jsx)(B,{execBorrow:x,debtChange:r,txnStatus:g,onClose:()=>{c(),e()},isOpen:t}):null},R=M},99581:(e,t,r)=>{r.d(t,{M:()=>d});var n=r(2784),i=r(84626),o=r(87651),s=r(59176),a=r(65068),c=r(52322);const l="true"===window?.localStorage?.CONTRACT_ERROR_OPEN;function d({contractError:e}){const[t,r]=n.useState(l);return(0,c.jsxs)(c.Fragment,{children:[t?null:(0,c.jsx)(i.z,{variant:"link",onClick:()=>r(!0),color:"inherit",fontWeight:"normal",fontStyle:"italic",children:"details..."}),(0,c.jsxs)(o.U,{in:t,animateOpacity:!0,children:[(0,c.jsx)(s.x,{fontStyle:"italic",fontSize:"0.8em",children:e.name}),(0,c.jsx)(s.x,{whiteSpace:"pre",fontSize:"0.8em",fontStyle:"italic",pl:"0.5em",children:Object.entries(e.args).map((([e,t])=>`${e}: ${t instanceof Date?(0,a.Z)(t,"yyyy-MM-dd HH:mm:ss"):t}`)).join("\n")})]})]})}},25042:(e,t,r)=>{r.d(t,{nQ:()=>c,Tw:()=>l,P0:()=>m});var n=r(38035),i=r(81540),o=r(28535),s=r(21112),a=r(52322);const c=(0,s.I)({viewBox:"0 0 14 14",path:(0,a.jsx)("g",{fill:"currentColor",children:(0,a.jsx)("polygon",{points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})})}),l=(0,s.I)({d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"});function d({status:e,children:t}){switch(!0){case e.failed:return(0,a.jsx)(l,{color:"white"});case e.success:return(0,a.jsx)(c,{color:"white"});case e.loading:return(0,a.jsx)(i.$,{color:"white",width:6,height:6});case e.disabled:default:return(0,a.jsx)(o.xu,{__css:{display:"inline",fontWeight:"medium",textAlign:"center",fontSize:"md"},children:t})}}function u(e){switch(!0){case e.failed:return"red.700";case e.disabled:case e.loading:return"gray.700";case e.success:return"green.700";default:return"gray.700"}}function h({status:e,children:t}){return(0,a.jsx)(n.k,{width:10,height:10,minWidth:10,minHeight:10,justifyContent:"center",alignItems:"center",bg:u(e),rounded:"full",transitionProperty:"background",transitionDuration:"normal",children:(0,a.jsx)(d,{status:e,children:t})})}var x=r(78876),p=r(59176);function g({children:e,...t}){return(0,a.jsx)(n.k,{mt:"0.5",children:(0,a.jsx)(x.X,{size:"sm",...t,children:(0,a.jsx)(o.xu,{fontSize:"xs",opacity:"0.66",children:e})})})}function m({step:e,title:t,subtitle:r,checkboxLabel:i,checkboxProps:o,status:s,children:c}){return(0,a.jsxs)(n.k,{position:"relative",alignItems:"center",gap:4,rounded:"lg",mt:"4",p:"4",border:"2px solid",transitionProperty:"border-color",transitionDuration:"normal",borderColor:u(s),children:[(0,a.jsx)(h,{status:s,children:e}),(0,a.jsxs)(n.k,{direction:"column",children:[(0,a.jsx)(p.x,{"data-cy":`multistep-${e}`,children:t}),r?(0,a.jsx)(p.x,{as:"div",fontSize:"xs",opacity:"0.66",children:r}):null,i?(0,a.jsx)(g,{...o,children:i}):null,c]})]})}},97721:(e,t,r)=>{r.d(t,{o:()=>l});r(5875),r(50509),r(38728),r(64810),r(43419),r(32825),r(16093),r(77829),r(60253),r(49225),r(79941),r(57265),r(25888),r(15840),r(37610),r(13351);var n=r(79155),i=r(50986),o=r(10528),s=r(49494),a=r(2784),c=r(60341);function l(e){return(0,a.useCallback)((t=>{if(e)try{const r=t?.error?.data?.data||t?.error?.error?.data;if(!r)return void console.error({error:t});const a=e.interface.format(n.pc.full),l=new i.CH(e.address,Array.from(new Set(a.concat(c.IN).concat(["error CannotSelfApprove(address addr)","error InvalidTransferRecipient(address addr)","error InvalidOwner(address addr)","error TokenDoesNotExist(uint256 id)","error TokenAlreadyMinted(uint256 id)"]))),e.signer||e.provider).interface.parseError(r),d=Object.fromEntries(Object.entries(l.args).filter((([e])=>`${parseInt(e)}`!==e)).map((([e,t])=>{if(t instanceof o.O$){const r=parseFloat(s.formatEther(t.toString()));return r>.001?[e,r]:t.toNumber()>new Date(2e3,1,1).getTime()/1e3&&t.toNumber()<new Date(2100,1,1).getTime()/1e3?[e,new Date(1e3*t.toNumber())]:[e,parseFloat(t.toString())]}return[e,t]})));return{data:r,name:l.name,signature:l.signature,args:d}}catch(e){return void console.error(e)}}),[e])}}}]);
//# sourceMappingURL=3967.75cfb3a0.js.map