"use strict";(globalThis.webpackChunk_snx_v3_liquidity=globalThis.webpackChunk_snx_v3_liquidity||[]).push([[7665],{17665:(t,a,e)=>{e.r(a),e.d(a,{WithdrawModal:()=>Q,WithdrawModalUi:()=>M,default:()=>G});var s=e(11082),r=e(59176),o=e(74008),i=e(84626),n=e(70065),l=e(2784),d=e(25042),c=e(96596),u=e(17716),p=e(908),w=e(29542),h=e(40109),y=e(99),m=e(35834),g=e(95772),b=e(51299),x=e(28145),f=e(50986),v=e(10528);const C=({accountId:t,collateralTypeAddress:a,amount:e})=>{const[s,r]=(0,l.useReducer)(u.I,u.E),{data:o}=(0,h.a)(),{data:i,refetch:n}=(0,w.Y)(),{network:d}=(0,p.LN)(),{gasSpeed:C}=(0,g.jU)(),S=(0,p.mx)(),j=(0,p.yL)(),k=(0,x.useMutation)({mutationFn:async()=>{if(!S||!d||!j)throw new Error("No signer or network");if(!(o&&a&&e))throw new Error("Not ready");if(e?.eq(0))throw new Error("Amount less than 0");const s=await S.getAddress();try{r({type:"prompting"});const n=new f.CH(a,["function decimals() view returns (uint8)"],j),l=await n.decimals(),u=e.gt(0)?(0,c.vz)(e.toString(),l):v.O$.from(0),p=o.populateTransaction.withdraw(v.O$.from(t),a,u),w=Promise.all([p]),[h,g]=await Promise.all([w,(0,m.o)({provider:j})]);i&&h.unshift(i);const x=await(0,b.dI)(d,h,"useWithdraw",s),k=(0,y.F)({gasLimit:x.gasLimit,gasPrices:g,gasSpeed:C}),A=await S.sendTransaction({...x,...k});r({type:"pending",payload:{txnHash:A.hash}}),await A.wait(),r({type:"success"})}catch(t){throw r({type:"error",payload:{error:t}}),t}},onSuccess:()=>{n()}});return{mutation:k,txnState:s,settle:()=>r({type:"settled"}),isLoading:k.isPending,exec:k.mutateAsync}};var S=e(1492),j=e(97721),k=e(99581),A=e(75429),T=e(21849),D=e(77528),W=e(42219),$=e(37330),N=e(34367),E=e(7226),I=e(19175),L=e(51906),P=e(49494);const q=({accountId:t,availableCollateral:a,snxUSDCollateral:e,amountToWithdraw:s,accountCollateral:r,collateralSymbol:o})=>{const[i,n]=(0,l.useReducer)(u.I,u.E),{data:d}=(0,h.a)(),{data:c}=(0,E.b)(),{data:f}=(0,I.a)(),{data:C,refetch:S}=(0,w.Y)(),{network:j}=(0,p.LN)(),{data:k}=(0,N.X)(),{gasSpeed:A}=(0,g.jU)(),T=(0,p.mx)(),q=(0,p.yL)(),U=(0,x.useMutation)({mutationFn:async()=>{if(!T||!j||!q)throw new Error("No signer or network");if(!(d&&c&&t&&k?.sUSD&&k.snxUSD))throw new Error("Not ready");if(e.add(a).lt(s))throw new Error("Exceeds balance");const i=s.gt(a)?a:s,l=s.sub(i).gt(0)?s.sub(i):W.GH;try{const e=(0,D.$l)(o);n({type:"prompting"});const s=(0,m.o)({provider:q}),u=i.gt(0)?d.populateTransaction.withdraw(v.O$.from(t),r?.tokenAddress,i.toBN()):void 0,p=l.gt(0)?d.populateTransaction.withdraw(v.O$.from(t),k?.snxUSD,l.toBN()):void 0,w=l.gt(0)?f?.populateTransaction.approve(c.address,l.toBN()):void 0,h=l.gt(0)?c.populateTransaction.buy(e,l.toBN(),0,L.d):void 0,g=l.gt(0)?(await c.callStatic.quoteBuyExactIn(e,l.toBN(),0)).synthAmount:W.GH,x=a.add(g),S=c.populateTransaction.unwrap(e,x.toBN(),Number(P.formatUnits(x.toBN().mul(98).div(100).toString(),12).toString()).toFixed()),[N,E,I,U,B,H]=await Promise.all([s,u,p,w,h,S]),O=[E,I,U,B,H].filter($._);C&&O.unshift(C);const _=await T.getAddress(),F=await(0,b.dI)(j,O,"useWithdrawBase",_),M=(0,y.F)({gasLimit:F.gasLimit,gasPrices:N,gasSpeed:A}),Q=await T.sendTransaction({...F,...M});n({type:"pending",payload:{txnHash:Q.hash}}),await Q.wait(),n({type:"success"})}catch(t){throw n({type:"error",payload:{error:t}}),t}},onSuccess:()=>{S()}});return{mutation:U,txnState:i,settle:()=>n({type:"settled"}),isLoading:U.isPending,exec:U.mutateAsync}};var U=e(13797),B=e(89536),H=e(45071),O=e(73635),_=e(64996),F=e(52322);const M=({isDebtWithdrawal:t,amount:a,isOpen:e,onClose:n,onSubmit:l,state:c,symbol:u})=>{if(e)return c.step>1?(0,F.jsx)(T.s,{onClose:l,title:(t?"Debt":"Collateral")+" successfully Withdrawn",subline:(0,F.jsxs)(F.Fragment,{children:["Your ",(0,F.jsx)("b",{children:t?"Debt":"Collateral"})," has been withdrawn, read more about it in the"," ",(0,F.jsx)(s.r,{href:"https://docs.synthetix.io/v/synthetix-v3-user-documentation",target:"_blank",color:"cyan.500",children:"Synthetix V3 Documentation"})]}),alertText:(t?"Debt":"Collateral")+" successfully Withdrawn"}):(0,F.jsxs)("div",{"data-cy":"withdraw multistep",children:[(0,F.jsxs)(r.x,{color:"gray.50",fontSize:"20px",fontWeight:700,children:[(0,F.jsx)(A.R,{cursor:"pointer",onClick:n,mr:2}),"Manage ",t?"Debt":"Collateral"]}),(0,F.jsx)(o.i,{my:4}),(0,F.jsx)(d.P0,{step:1,title:"Withdraw",subtitle:(0,F.jsxs)(r.x,{as:"div",children:[(0,F.jsx)(H.$,{value:a}),"Â ",u," will be withdrawn"]}),status:{failed:1===c.step&&"error"===c.status,success:c.step>1,loading:1===c.step&&"pending"===c.status}}),(0,F.jsx)(i.z,{isDisabled:"pending"===c.status,onClick:l,width:"100%",mt:"6","data-cy":"withdraw confirm button",children:(()=>{switch(!0){case"error"===c.status:return"Retry";case"pending"===c.status:return"Processing...";case c.step>1:return"Done";default:return"Execute Transaction"}})()})]})};function Q({liquidityPosition:t,onClose:a,isOpen:e,isDebtWithdrawal:s=!1}){const[r,o]=(0,l.useState)({step:1,status:"idle"}),i=(0,B.UO)(),d=(0,n.p)({isClosable:!0,duration:9e3}),{network:c}=(0,p.LN)(),u=(0,x.useQueryClient)(),{withdrawAmount:w,setWithdrawAmount:y}=(0,l.useContext)(U.n),{data:m}=(0,_.t)(i.collateralSymbol),{data:g}=(0,h.a)(),b=(0,j.o)(g),f=t?.accountId,{data:v}=(0,O.p)(),{data:A}=(0,S.jZ)(f,v?.address),{mutation:T}=C({amount:w,accountId:f,collateralTypeAddress:s?v?.address:t?.accountCollateral?.tokenAddress}),{mutation:$}=q({accountId:f,availableCollateral:t?.accountCollateral.availableCollateral||W.GH,snxUSDCollateral:A?.availableCollateral||W.GH,amountToWithdraw:w,accountCollateral:t?.accountCollateral,collateralSymbol:i.collateralSymbol}),N=(0,l.useCallback)((async()=>{try{1===r.step?(o({step:1,status:"pending"}),(0,D.Yz)(c?.id,c?.preset)?await $.mutateAsync():await T.mutateAsync(),o({step:2,status:"success"}),u.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"LiquidityPosition",{accountId:f}]}),u.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"AccountSpecificCollateral",{accountId:f}]}),u.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"LiquidityPositions",{accountId:f}]}),u.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"AccountCollateralUnlockDate",{accountId:f}]}),u.invalidateQueries({queryKey:[`${c?.id}-${c?.preset}`,"TokenBalance"]}),y(W.GH)):a()}catch(t){o((t=>({...t,status:"error"})));const a=b(t);throw a&&console.error(new Error(a.name),a),d.closeAll(),d({title:"Withdraw failed",description:a?(0,F.jsx)(k.M,{contractError:a}):"Please try again.",status:"error",variant:"left-accent"}),Error("Withdraw failed",{cause:t})}}),[f,b,c?.id,c?.preset,a,u,y,d,r.step,$,T]);return(0,F.jsx)(M,{amount:w,isOpen:e,onClose:a,symbol:s?v?.symbol:m?.symbol,state:r,onSubmit:N,isDebtWithdrawal:s})}const G=Q}}]);
//# sourceMappingURL=7665.283578c0.js.map